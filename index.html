<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>coderz - è®°å½•æ¯ä¸€åˆ» | coderz</title>

  
  <meta name="author" content="coderz">
  

  
  <meta name="description" content="coderz- è®°å½•ä¸ªäººæ—¥å¸¸">
  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="coderz - è®°å½•æ¯ä¸€åˆ»"/>

  
  <meta property="og:image" content="/io/favicon.ico"/>
  

  <link href="/io/favicon.ico" rel="icon">
  <link rel="alternate" href="/io/atom.xml" title="coderz - è®°å½•æ¯ä¸€åˆ»" type="application/atom+xml">
  <link rel="stylesheet" href="/io/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/io/">coderz - è®°å½•æ¯ä¸€åˆ»</a>
    </h1>
    <p class="site-description">coderz</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/io/2021/07/26/å¦‚ä½•è§„èŒƒæ­å»ºä¸€ä¸ªvueå·¥ç¨‹é¡¹ç›®/"><span>å¦‚ä½•è§„èŒƒæ­å»ºä¸€ä¸ªVueå·¥ç¨‹é¡¹ç›®</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/io/2021/07/26/å¦‚ä½•è§„èŒƒæ­å»ºä¸€ä¸ªvueå·¥ç¨‹é¡¹ç›®/" rel="bookmark">
        <time class="entry-date published" datetime="2021-07-26T09:20:59.000Z">
          2021-07-26
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="ä¸€-é¡¹ç›®è§„èŒƒçš„äº”ä¸ªæ­¥éª¤"><a href="#ä¸€-é¡¹ç›®è§„èŒƒçš„äº”ä¸ªæ­¥éª¤" class="headerlink" title="ä¸€. é¡¹ç›®è§„èŒƒçš„äº”ä¸ªæ­¥éª¤"></a>ä¸€. é¡¹ç›®è§„èŒƒçš„äº”ä¸ªæ­¥éª¤</h2><p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸€ä¸ªé¡¹ç›®é€šå¸¸ä¼šæœ‰å¤šäººè¿›è¡Œå¼€å‘ç»´æŠ¤ï¼Œå¤šäººå°±ä¼šé¢ä¸´ç€ç§ç§ä¸è§„èŒƒçš„é—®é¢˜ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œåœ¨æ–‡ä»¶ä¸­æœ‰äº›åŒäº‹å–œæ¬¢ä½¿ç”¨â€â€ï¼Œæœ‰äº›åŒäº‹å–œæ¬¢ä½¿ç”¨â€™â€™ï¼Œæ˜¾ç„¶å¦‚æœæ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„è§„èŒƒæ•´ä¸ªå·¥ç¨‹ä¼šæ˜¾å¾—æ‚ä¹±ï¼Œä¸è§„æ•´ã€‚</p>
<p>é‚£ä¹ˆæ‰‹åŠ¨ä¸€ä¸ªä¸ªå»æ”¹åŠ¨æ˜¾ç„¶ä¹Ÿæ˜¯ä¸å¤ªç°å®çš„ï¼Œæ‰€ä»¥ä»å·¥ç¨‹åŒ–æ‰‹æ®µå…¥æ‰‹æ¥è§£å†³æ­¤ç±»å°±å¾ˆæœ‰å¿…è¦ï¼Œä» start å¼€å§‹å°±å¯¹é¡¹ç›®è¿›è¡Œå¿…è¦çš„è®¾å®šæ¥è¾¾åˆ°ç»Ÿä¸€çš„å¼€å§‹æ ‡å‡†</p>
<h3 id="1-1-é›†æˆeditorconfigé…ç½®"><a href="#1-1-é›†æˆeditorconfigé…ç½®" class="headerlink" title="1.1. é›†æˆeditorconfigé…ç½®"></a>1.1. é›†æˆeditorconfigé…ç½®</h3><p>EditorConfig æœ‰åŠ©äºä¸ºä¸åŒ IDE ç¼–è¾‘å™¨ä¸Šå¤„ç†åŒä¸€é¡¹ç›®çš„å¤šä¸ªå¼€å‘äººå‘˜ç»´æŠ¤ä¸€è‡´çš„ç¼–ç é£æ ¼ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://editorconfig.org</span></span><br><span class="line"></span><br><span class="line"><span class="string">root</span> <span class="string">=</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[<span class="string">*</span>] <span class="comment"># è¡¨ç¤ºæ‰€æœ‰æ–‡ä»¶é€‚ç”¨</span></span><br><span class="line"><span class="string">charset</span> <span class="string">=</span> <span class="string">utf-8</span> <span class="comment"># è®¾ç½®æ–‡ä»¶å­—ç¬¦é›†ä¸º utf-8</span></span><br><span class="line"><span class="string">indent_style</span> <span class="string">=</span> <span class="string">space</span> <span class="comment"># ç¼©è¿›é£æ ¼ï¼ˆtab | spaceï¼‰</span></span><br><span class="line"><span class="string">indent_size</span> <span class="string">=</span> <span class="number">2</span> <span class="comment"># ç¼©è¿›å¤§å°</span></span><br><span class="line"><span class="string">end_of_line</span> <span class="string">=</span> <span class="string">lf</span> <span class="comment"># æ§åˆ¶æ¢è¡Œç±»å‹(lf | cr | crlf)</span></span><br><span class="line"><span class="string">trim_trailing_whitespace</span> <span class="string">=</span> <span class="literal">true</span> <span class="comment"># å»é™¤è¡Œé¦–çš„ä»»æ„ç©ºç™½å­—ç¬¦</span></span><br><span class="line"><span class="string">insert_final_newline</span> <span class="string">=</span> <span class="literal">true</span> <span class="comment"># å§‹ç»ˆåœ¨æ–‡ä»¶æœ«å°¾æ’å…¥ä¸€ä¸ªæ–°è¡Œ</span></span><br><span class="line"></span><br><span class="line">[<span class="string">*.md</span>] <span class="comment"># è¡¨ç¤ºä»… md æ–‡ä»¶é€‚ç”¨ä»¥ä¸‹è§„åˆ™</span></span><br><span class="line"><span class="string">max_line_length</span> <span class="string">=</span> <span class="string">off</span></span><br><span class="line"><span class="string">trim_trailing_whitespace</span> <span class="string">=</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>



<p>VSCodeéœ€è¦å®‰è£…ä¸€ä¸ªæ’ä»¶ï¼šEditorConfig for VS Code</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsq2gh989yj30pj05ggmb.jpg" alt="image-20210722215138665"></p>
<h3 id="1-2-ä½¿ç”¨prettierå·¥å…·"><a href="#1-2-ä½¿ç”¨prettierå·¥å…·" class="headerlink" title="1.2. ä½¿ç”¨prettierå·¥å…·"></a>1.2. ä½¿ç”¨prettierå·¥å…·</h3><p>Prettier æ˜¯ä¸€æ¬¾å¼ºå¤§çš„ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œæ”¯æŒ JavaScriptã€TypeScriptã€CSSã€SCSSã€Lessã€JSXã€Angularã€Vueã€GraphQLã€JSONã€Markdown ç­‰è¯­è¨€ï¼ŒåŸºæœ¬ä¸Šå‰ç«¯èƒ½ç”¨åˆ°çš„æ–‡ä»¶æ ¼å¼å®ƒéƒ½å¯ä»¥æå®šï¼Œæ˜¯å½“ä¸‹æœ€æµè¡Œçš„ä»£ç æ ¼å¼åŒ–å·¥å…·ã€‚</p>
<p>1.å®‰è£…prettier</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install prettier -D</span><br></pre></td></tr></table></figure>

<p>2.é…ç½®.prettierrcæ–‡ä»¶ï¼š</p>
<ul>
<li>useTabsï¼šä½¿ç”¨tabç¼©è¿›è¿˜æ˜¯ç©ºæ ¼ç¼©è¿›ï¼Œé€‰æ‹©falseï¼›</li>
<li>tabWidthï¼štabæ˜¯ç©ºæ ¼çš„æƒ…å†µä¸‹ï¼Œæ˜¯å‡ ä¸ªç©ºæ ¼ï¼Œé€‰æ‹©2ä¸ªï¼›</li>
<li>printWidthï¼šå½“è¡Œå­—ç¬¦çš„é•¿åº¦ï¼Œæ¨è80ï¼Œä¹Ÿæœ‰äººå–œæ¬¢100æˆ–è€…120ï¼›</li>
<li>singleQuoteï¼šä½¿ç”¨å•å¼•å·è¿˜æ˜¯åŒå¼•å·ï¼Œé€‰æ‹©trueï¼Œä½¿ç”¨å•å¼•å·ï¼›</li>
<li>trailingCommaï¼šåœ¨å¤šè¡Œè¾“å…¥çš„å°¾é€—å·æ˜¯å¦æ·»åŠ ï¼Œè®¾ç½®ä¸º <code>none</code>ï¼›</li>
<li>semiï¼šè¯­å¥æœ«å°¾æ˜¯å¦è¦åŠ åˆ†å·ï¼Œé»˜è®¤å€¼trueï¼Œé€‰æ‹©falseè¡¨ç¤ºä¸åŠ ï¼›</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;useTabs&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;tabWidth&quot;</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">&quot;printWidth&quot;</span>: <span class="number">80</span>,</span><br><span class="line">  <span class="attr">&quot;singleQuote&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;trailingComma&quot;</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;semi&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>3.åˆ›å»º.prettierignoreå¿½ç•¥æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;dist&#x2F;*</span><br><span class="line">.local</span><br><span class="line">.output.js</span><br><span class="line">&#x2F;node_modules&#x2F;**</span><br><span class="line"></span><br><span class="line">**&#x2F;*.svg</span><br><span class="line">**&#x2F;*.sh</span><br><span class="line"></span><br><span class="line">&#x2F;public&#x2F;*</span><br></pre></td></tr></table></figure>



<p>4.VSCodeéœ€è¦å®‰è£…prettierçš„æ’ä»¶</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsq2acx21rj30ow057mxp.jpg" alt="image-20210722214543454"></p>
<p>5.æµ‹è¯•prettieræ˜¯å¦ç”Ÿæ•ˆ</p>
<ul>
<li>æµ‹è¯•ä¸€ï¼šåœ¨ä»£ç ä¸­ä¿å­˜ä»£ç ï¼›</li>
<li>æµ‹è¯•äºŒï¼šé…ç½®ä¸€æ¬¡æ€§ä¿®æ”¹çš„å‘½ä»¤ï¼›</li>
</ul>
<p>åœ¨package.jsonä¸­é…ç½®ä¸€ä¸ªscriptsï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;prettier&quot;: &quot;prettier --write .&quot;</span><br></pre></td></tr></table></figure>



<h3 id="1-3-ä½¿ç”¨ESLintæ£€æµ‹"><a href="#1-3-ä½¿ç”¨ESLintæ£€æµ‹" class="headerlink" title="1.3. ä½¿ç”¨ESLintæ£€æµ‹"></a>1.3. ä½¿ç”¨ESLintæ£€æµ‹</h3><p>1.åœ¨å‰é¢åˆ›å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±é€‰æ‹©äº†ESLintï¼Œæ‰€ä»¥Vueä¼šé»˜è®¤å¸®åŠ©æˆ‘ä»¬é…ç½®éœ€è¦çš„ESLintç¯å¢ƒã€‚</p>
<p>2.VSCodeéœ€è¦å®‰è£…ESLintæ’ä»¶ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsq2oq26odj30pw05faaq.jpg" alt="image-20210722215933360"></p>
<p>3.è§£å†³eslintå’Œprettierå†²çªçš„é—®é¢˜ï¼š</p>
<p>å®‰è£…æ’ä»¶ï¼šï¼ˆvueåœ¨åˆ›å»ºé¡¹ç›®æ—¶ï¼Œå¦‚æœé€‰æ‹©prettierï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ’ä»¶ä¼šè‡ªåŠ¨å®‰è£…ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i eslint-plugin-prettier eslint-config-prettier -D</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ prettieræ’ä»¶ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">extends: [</span><br><span class="line">  &quot;plugin:vue/vue3-essential&quot;,</span><br><span class="line">  &quot;eslint:recommended&quot;,</span><br><span class="line">  &quot;@vue/typescript/recommended&quot;,</span><br><span class="line">  &quot;@vue/prettier&quot;,</span><br><span class="line">  &quot;@vue/prettier/@typescript-eslint&quot;,</span><br><span class="line">  &#x27;plugin:prettier/recommended&#x27;</span><br><span class="line">],</span><br></pre></td></tr></table></figure>



<h3 id="1-4-git-Huskyå’Œeslint"><a href="#1-4-git-Huskyå’Œeslint" class="headerlink" title="1.4. git Huskyå’Œeslint"></a>1.4. git Huskyå’Œeslint</h3><p>è™½ç„¶æˆ‘ä»¬å·²ç»è¦æ±‚é¡¹ç›®ä½¿ç”¨eslintäº†ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯ç»„å‘˜æäº¤ä»£ç ä¹‹å‰éƒ½å°†eslintä¸­çš„é—®é¢˜è§£å†³æ‰äº†ï¼š</p>
<ul>
<li><p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸Œæœ›ä¿è¯ä»£ç ä»“åº“ä¸­çš„ä»£ç éƒ½æ˜¯ç¬¦åˆeslintè§„èŒƒçš„ï¼›</p>
</li>
<li><p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨ç»„å‘˜æ‰§è¡Œ <code>git commit </code> å‘½ä»¤çš„æ—¶å€™å¯¹å…¶è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœä¸ç¬¦åˆeslintè§„èŒƒï¼Œé‚£ä¹ˆè‡ªåŠ¨é€šè¿‡è§„èŒƒè¿›è¡Œä¿®å¤ï¼›</p>
</li>
</ul>
<p>é‚£ä¹ˆå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿå¯ä»¥é€šè¿‡Huskyå·¥å…·ï¼š</p>
<ul>
<li>huskyæ˜¯ä¸€ä¸ªgit hookå·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è§¦å‘gitæäº¤çš„å„ä¸ªé˜¶æ®µï¼špre-commitã€commit-msgã€pre-push</li>
</ul>
<p>å¦‚ä½•ä½¿ç”¨huskyå‘¢ï¼Ÿ</p>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªåŠ¨é…ç½®å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx husky-init &amp;&amp; npm install</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¼šåšä¸‰ä»¶äº‹ï¼š</p>
<p>1.å®‰è£…huskyç›¸å…³çš„ä¾èµ–ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsqq0o5jxmj30bb04qwen.jpg" alt="image-20210723112648927"></p>
<p>2.åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º <code>.husky</code> æ–‡ä»¶å¤¹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsqq16zo75j307703mt8m.jpg" alt="image-20210723112719634"></p>
<p>3.åœ¨package.jsonä¸­æ·»åŠ ä¸€ä¸ªè„šæœ¬ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsqq26phpxj30dj06fgm3.jpg" alt="image-20210723112817691"></p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å»å®Œæˆä¸€ä¸ªæ“ä½œï¼šåœ¨è¿›è¡Œcommitæ—¶ï¼Œæ‰§è¡Œlintè„šæœ¬ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsqq3hn229j30nf04z74q.jpg" alt="image-20210723112932943"></p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ‰§è¡Œgit commitçš„æ—¶å€™ä¼šè‡ªåŠ¨å¯¹ä»£ç è¿›è¡Œlintæ ¡éªŒã€‚</p>
<h3 id="1-5-git-commitè§„èŒƒ"><a href="#1-5-git-commitè§„èŒƒ" class="headerlink" title="1.5. git commitè§„èŒƒ"></a>1.5. git commitè§„èŒƒ</h3><h4 id="1-5-1-ä»£ç æäº¤é£æ ¼"><a href="#1-5-1-ä»£ç æäº¤é£æ ¼" class="headerlink" title="1.5.1. ä»£ç æäº¤é£æ ¼"></a>1.5.1. ä»£ç æäº¤é£æ ¼</h4><p>é€šå¸¸æˆ‘ä»¬çš„git commitä¼šæŒ‰ç…§ç»Ÿä¸€çš„é£æ ¼æ¥æäº¤ï¼Œè¿™æ ·å¯ä»¥å¿«é€Ÿå®šä½æ¯æ¬¡æäº¤çš„å†…å®¹ï¼Œæ–¹ä¾¿ä¹‹åå¯¹ç‰ˆæœ¬è¿›è¡Œæ§åˆ¶ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsqw17gaqjj30to0cj3zp.jpg"></p>
<p>ä½†æ˜¯å¦‚æœæ¯æ¬¡æ‰‹åŠ¨æ¥ç¼–å†™è¿™äº›æ˜¯æ¯”è¾ƒéº»çƒ¦çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå·¥å…·ï¼šCommitizen</p>
<ul>
<li>Commitizen æ˜¯ä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬ç¼–å†™è§„èŒƒ commit message çš„å·¥å…·ï¼›</li>
</ul>
<p>1.å®‰è£…Commitizen</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install commitizen -D</span><br></pre></td></tr></table></figure>

<p>2.å®‰è£…cz-conventional-changelogï¼Œå¹¶ä¸”åˆå§‹åŒ–cz-conventional-changelogï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx commitizen init cz-conventional-changelog --save-dev --save-exact</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤ä¼šå¸®åŠ©æˆ‘ä»¬å®‰è£…cz-conventional-changelogï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsqvz2odi4j30ek00zmx2.jpg" alt="image-20210723145249096"></p>
<p>å¹¶ä¸”åœ¨package.jsonä¸­è¿›è¡Œé…ç½®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsqvzftay5j30iu04k74d.jpg"></p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æäº¤ä»£ç éœ€è¦ä½¿ç”¨ <code>npx cz</code>ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥æ˜¯é€‰æ‹©typeï¼Œæœ¬æ¬¡æ›´æ–°çš„ç±»å‹</li>
</ul>
<table>
<thead>
<tr>
<th>Type</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>feat</td>
<td>æ–°å¢ç‰¹æ€§ (feature)</td>
</tr>
<tr>
<td>fix</td>
<td>ä¿®å¤ Bug(bug fix)</td>
</tr>
<tr>
<td>docs</td>
<td>ä¿®æ”¹æ–‡æ¡£ (documentation)</td>
</tr>
<tr>
<td>style</td>
<td>ä»£ç æ ¼å¼ä¿®æ”¹(white-space, formatting, missing semi colons, etc)</td>
</tr>
<tr>
<td>refactor</td>
<td>ä»£ç é‡æ„(refactor)</td>
</tr>
<tr>
<td>perf</td>
<td>æ”¹å–„æ€§èƒ½(A code change that improves performance)</td>
</tr>
<tr>
<td>test</td>
<td>æµ‹è¯•(when adding missing tests)</td>
</tr>
<tr>
<td>build</td>
<td>å˜æ›´é¡¹ç›®æ„å»ºæˆ–å¤–éƒ¨ä¾èµ–ï¼ˆä¾‹å¦‚ scopes: webpackã€gulpã€npm ç­‰ï¼‰</td>
</tr>
<tr>
<td>ci</td>
<td>æ›´æ”¹æŒç»­é›†æˆè½¯ä»¶çš„é…ç½®æ–‡ä»¶å’Œ package ä¸­çš„ scripts å‘½ä»¤ï¼Œä¾‹å¦‚ scopes: Travis, Circle ç­‰</td>
</tr>
<tr>
<td>chore</td>
<td>å˜æ›´æ„å»ºæµç¨‹æˆ–è¾…åŠ©å·¥å…·(æ¯”å¦‚æ›´æ”¹æµ‹è¯•ç¯å¢ƒ)</td>
</tr>
<tr>
<td>revert</td>
<td>ä»£ç å›é€€</td>
</tr>
</tbody></table>
<ul>
<li>ç¬¬äºŒæ­¥é€‰æ‹©æœ¬æ¬¡ä¿®æ”¹çš„èŒƒå›´ï¼ˆä½œç”¨åŸŸï¼‰</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsqw8ca15oj30r600wmx4.jpg" alt="image-20210723150147510"></p>
<ul>
<li>ç¬¬ä¸‰æ­¥é€‰æ‹©æäº¤çš„ä¿¡æ¯</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsqw8mq3zlj60ni01hmx402.jpg" alt="image-20210723150204780"></p>
<ul>
<li>ç¬¬å››æ­¥æäº¤è¯¦ç»†çš„æè¿°ä¿¡æ¯</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsqw8y05bjj30kt01fjrb.jpg" alt="image-20210723150223287"></p>
<ul>
<li>ç¬¬äº”æ­¥æ˜¯å¦æ˜¯ä¸€æ¬¡é‡å¤§çš„æ›´æ”¹</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsqw9z5vbij30bm00q744.jpg" alt="image-20210723150322122"></p>
<ul>
<li>ç¬¬å…­æ­¥æ˜¯å¦å½±å“æŸä¸ªopen issue</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsqwar8xp1j30fq00ya9x.jpg" alt="image-20210723150407822"></p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨scriptsä¸­æ„å»ºä¸€ä¸ªå‘½ä»¤æ¥æ‰§è¡Œ czï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gsqwc4gtkxj30e207174t.jpg" alt="image-20210723150526211"></p>
<h4 id="1-5-2-ä»£ç æäº¤éªŒè¯"><a href="#1-5-2-ä»£ç æäº¤éªŒè¯" class="headerlink" title="1.5.2. ä»£ç æäº¤éªŒè¯"></a>1.5.2. ä»£ç æäº¤éªŒè¯</h4><p>å¦‚æœæˆ‘ä»¬æŒ‰ç…§czæ¥è§„èŒƒäº†æäº¤é£æ ¼ï¼Œä½†æ˜¯ä¾ç„¶æœ‰åŒäº‹é€šè¿‡ <code>git commit</code> æŒ‰ç…§ä¸è§„èŒƒçš„æ ¼å¼æäº¤åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<ul>
<li>æˆ‘ä»¬å¯ä»¥é€šè¿‡commitlintæ¥é™åˆ¶æäº¤ï¼›</li>
</ul>
<p>1.å®‰è£… @commitlint/config-conventional å’Œ @commitlint/cli</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @commitlint/config-conventional @commitlint/cli -D</span><br></pre></td></tr></table></figure>

<p>2.åœ¨æ ¹ç›®å½•åˆ›å»ºcommitlint.config.jsæ–‡ä»¶ï¼Œé…ç½®commitlint</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="keyword">extends</span>: [<span class="string">&#x27;@commitlint/config-conventional&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.ä½¿ç”¨huskyç”Ÿæˆcommit-msgæ–‡ä»¶ï¼ŒéªŒè¯æäº¤ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx husky add .husky/commit-msg &quot;npx --no-install commitlint --edit $1&quot;</span><br></pre></td></tr></table></figure>

<h2 id="äºŒ-è‡ªå·±å†™çš„CMSåå°ç®¡ç†ç³»ç»Ÿ"><a href="#äºŒ-è‡ªå·±å†™çš„CMSåå°ç®¡ç†ç³»ç»Ÿ" class="headerlink" title="äºŒ.è‡ªå·±å†™çš„CMSåå°ç®¡ç†ç³»ç»Ÿ"></a>äºŒ.è‡ªå·±å†™çš„CMSåå°ç®¡ç†ç³»ç»Ÿ</h2><p>æœ€è¿‘çœ‹å®Œ <code>TypeScript + Vue3</code> å¼€å§‹ç€æ‰‹å†™çš„ä¸€ä¸ª CMS ç³»ç»Ÿç»ƒç»ƒæ‰‹ï¼Œæœ‰å…´è¶£å¯ä»¥ä¸‹è½½æ¥ğŸƒğŸƒ<a target="_blank" rel="noopener" href="https://github.com/coderx-waper/vue-ts-cms.git">vue-ts-cms</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/io/tags/vue/">vue</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/io/2021/06/18/Vue.js å®˜ç½‘ ç»“è®ºçš„ä¸€å¤„çš„é”™è¯¯/"><span>æ‰§è¡Œ setup æ—¶ï¼Œç»„ä»¶å®ä¾‹çœŸçš„å¦‚å®˜æ–¹æ‰€è¯´æœªåˆ›å»ºï¼Ÿ</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/io/2021/06/18/Vue.js å®˜ç½‘ ç»“è®ºçš„ä¸€å¤„çš„é”™è¯¯/" rel="bookmark">
        <time class="entry-date published" datetime="2021-06-18T09:29:53.000Z">
          2021-06-18
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="Vue-js-å®˜ç½‘-ç»“è®ºçš„ä¸€å¤„çš„é”™è¯¯"><a href="#Vue-js-å®˜ç½‘-ç»“è®ºçš„ä¸€å¤„çš„é”™è¯¯" class="headerlink" title="Vue.js å®˜ç½‘ ç»“è®ºçš„ä¸€å¤„çš„é”™è¯¯"></a>Vue.js å®˜ç½‘ ç»“è®ºçš„ä¸€å¤„çš„é”™è¯¯</h2><h4 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h4><blockquote>
<p>ä¸ºä»€ä¹ˆè¯´æ˜¯å¯¹Vue.jså®˜ç½‘ä¸€å¤„ç»“è®ºæè¿°é”™è¯¯çš„æ¢ç©¶å‘¢ï¼Ÿä¸»è¦æ˜¯åœ¨å­¦ä¹  Composition API çš„ <code>setup()</code>å‡½æ•°å‘ç°å®˜ç½‘æœ‰ä¸€æ®µè¿™æ ·çš„æ¨¡å¼</p>
<p><code>When</code>setup<code> is executed, the component instance has not been created yet. As a result, you will only be able to access the following properties:</code> </p>
<p>å…¶å«ä¹‰å°±æ˜¯ï¼šæ‰§è¡Œ <code>setup</code> æ—¶ï¼Œç»„ä»¶å®ä¾‹å°šæœªè¢«åˆ›å»ºã€‚å› æ­¤ï¼Œä½ åªèƒ½è®¿é—®ä»¥ä¸‹ propertyï¼Œä¸‹å›¾å°±æ˜¯å®˜æ–¹å¯¹æ­¤çš„æè¿°ï¼ŒçœŸå®æƒ…å†µå¦‚å…¶æ‰€è¯´å—ï¼Ÿ</p>
</blockquote>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88d7a049391d4e548bb5ba5876a055e3~tplv-k3u1fbpfcp-watermark.image" alt="æˆªå±2021-06-18 ä¸‹åˆ4.30.39.png"></p>
<h4 id="äºŒã€éªŒè¯è¿™ä¸ªé”™è¯¯"><a href="#äºŒã€éªŒè¯è¿™ä¸ªé”™è¯¯" class="headerlink" title="äºŒã€éªŒè¯è¿™ä¸ªé”™è¯¯"></a>äºŒã€éªŒè¯è¿™ä¸ªé”™è¯¯</h4><p>æ­£æ‰€è°“äº†è§£çœŸç›¸ï¼Œæ–¹èƒ½è‡ªç”±ã€‚æ¢ç´¢è¿™ä¸ªé—®é¢˜çš„å¯¹é”™å¿…é¡»ä¾èµ– Vue3æºç </p>
<ul>
<li>ä¸‹è½½ vue-next æºç </li>
</ul>
<p>åœ¨æ•´ä¸ªæºç ä¸­æ ¸å¿ƒæ–‡ä»¶ï¼š<code> runtime-core</code>ã€<code> runtime-dom</code>ã€<code> compiler-core</code>ã€<code> runtime-dom</code> å‡ ä¸ªæ–‡ä»¶</p>
<ul>
<li>è¿›å…¥åˆ° runtime-core æ–‡ä»¶å¤¹</li>
<li>æ‰“å¼€ <code>renderer.ts</code>æ–‡ä»¶</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥ä»544è¡Œä¸­çš„è¿™æ®µä»£ç å¼€å§‹ä¸€æ­¥æ­¥åˆ†æ</p>
<h5 id="2-1-å¤„ç†ç»„ä»¶èŠ‚ç‚¹ï¼Œè°ƒç”¨-processComponent"><a href="#2-1-å¤„ç†ç»„ä»¶èŠ‚ç‚¹ï¼Œè°ƒç”¨-processComponent" class="headerlink" title="2.1 å¤„ç†ç»„ä»¶èŠ‚ç‚¹ï¼Œè°ƒç”¨ processComponent"></a>2.1 å¤„ç†ç»„ä»¶èŠ‚ç‚¹ï¼Œè°ƒç”¨ <code>processComponent</code></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.COMPONENT) &#123;          </span><br><span class="line">  <span class="comment">// å¤„ç†ç»„ä»¶èŠ‚ç‚¹</span></span><br><span class="line">  processComponent(</span><br><span class="line">    n1,</span><br><span class="line">    n2,</span><br><span class="line">    container,</span><br><span class="line">    anchor,</span><br><span class="line">    parentComponent,</span><br><span class="line">    parentSuspense,</span><br><span class="line">    isSVG,</span><br><span class="line">    slotScopeIds,</span><br><span class="line">    optimized</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬æ¥çœ‹çœ‹ <code> processComponent</code> çš„å®ç°ä¸­å¾ˆæ˜æ˜¾ å·²ç»åˆ›å»ºäº† <code> instance</code> è¿™ä¹ˆä¸ªå®ä¾‹, æ¥ç€åœ¨1335è¡Œä¸­å¼€å§‹è°ƒç”¨ <code> setupComponent(instance)</code> å°† ä¸Šé¢åˆ›å»ºçš„<code> instance</code> ä¼ é€’äº†å‡ºå»</p>
<h5 id="2-2-ç»„ä»¶æŒ‚è½½ï¼Œè°ƒç”¨-mountComponent"><a href="#2-2-ç»„ä»¶æŒ‚è½½ï¼Œè°ƒç”¨-mountComponent" class="headerlink" title="2.2 ç»„ä»¶æŒ‚è½½ï¼Œè°ƒç”¨ mountComponent"></a>2.2 ç»„ä»¶æŒ‚è½½ï¼Œè°ƒç”¨ <code>mountComponent</code></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// ç»„ä»¶æŒ‚è½½</span></span><br><span class="line"><span class="keyword">const</span> mountComponent: MountComponentFn = (</span><br><span class="line">  initialVNode,</span><br><span class="line">  container, </span><br><span class="line">  anchor,</span><br><span class="line">  parentComponent,</span><br><span class="line">  parentSuspense,</span><br><span class="line">  isSVG,</span><br><span class="line">  optimized</span><br><span class="line">) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 2.x compat may pre-creaate the component instance before actually</span></span><br><span class="line">  <span class="comment">// mounting</span></span><br><span class="line">  <span class="keyword">const</span> compatMountInstance = __COMPAT__ &amp;&amp; initialVNode.component</span><br><span class="line">  <span class="comment">// åœ¨è¿™é‡Œåˆ›å»ºäº† ComponentInternalInstance </span></span><br><span class="line">  <span class="keyword">const</span> instance: ComponentInternalInstance =</span><br><span class="line">  compatMountInstance ||</span><br><span class="line">    (initialVNode.component = createComponentInstance(</span><br><span class="line">    initialVNode,</span><br><span class="line">    parentComponent,</span><br><span class="line">    parentSuspense</span><br><span class="line">  ))</span><br></pre></td></tr></table></figure>

<h5 id="2-2-å¼€å§‹å¤„ç†-setupComponent"><a href="#2-2-å¼€å§‹å¤„ç†-setupComponent" class="headerlink" title="2.2 å¼€å§‹å¤„ç† setupComponent"></a>2.2 å¼€å§‹å¤„ç† <code>setupComponent</code></h5><p>è¯¥å‡½æ•°åœ¨ <code>component.ts</code>ä¸­è¿›è¡Œäº†å¤„ç†ï¼Œé‚£ä¹ˆå®ƒåˆæ˜¯å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">) =&gt; &#123;</span><br><span class="line"> <span class="comment">// 2.x compat may pre-creaate the component instance before actually</span></span><br><span class="line"> <span class="comment">// mounting</span></span><br><span class="line"> <span class="keyword">const</span> compatMountInstance = __COMPAT__ &amp;&amp; initialVNode.component</span><br><span class="line"> <span class="keyword">const</span> instance: ComponentInternalInstance =</span><br><span class="line">   compatMountInstance ||(initialVNode.component = createComponentInstance(</span><br><span class="line">   initialVNode,</span><br><span class="line">   parentComponent,</span><br><span class="line">   parentSuspense</span><br><span class="line">    ))</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; instance.type.__hmrId) &#123;</span><br><span class="line">    registerHMR(instance)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">    pushWarningContext(initialVNode)</span><br><span class="line">    startMeasure(instance, <span class="string">`mount`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// inject renderer internals for keepAlive</span></span><br><span class="line">  <span class="keyword">if</span> (isKeepAlive(initialVNode)) &#123;</span><br><span class="line">    ;(instance.ctx <span class="keyword">as</span> KeepAliveContext).renderer = internals</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// resolve props and slots for setup context</span></span><br><span class="line">   <span class="keyword">if</span> (!(__COMPAT__ &amp;&amp; compatMountInstance)) &#123;</span><br><span class="line">   <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">     startMeasure(instance, <span class="string">`init`</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// å¼€å§‹è°ƒç”¨ setup,å°† instance å®ä¾‹ä¼ é€’è¿›å…¥</span></span><br><span class="line">   setupComponent(instance)</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      endMeasure(instance, <span class="string">`init`</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒè½¬åˆ°å®ƒçš„å®ç°æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ ·ä¸€æ®µä»£ç å®ç°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­å¤„ç†å‡ ä»¶äº‹æƒ…</p>
<ul>
<li>è°ƒç”¨ <code>setupStatefulComponent</code> åˆå§‹åŒ–æœ‰çŠ¶æ€çš„ç»„ä»¶</li>
<li>åˆå§‹åŒ–<code> props</code> ã€ <code> slots</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setupComponent</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  instance: ComponentInternalInstance,</span></span></span><br><span class="line"><span class="function"><span class="params">  isSSR = <span class="literal">false</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  isInSSRComponentSetup = isSSR</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; props, children &#125; = instance.vnode</span><br><span class="line">  <span class="keyword">const</span> isStateful = isStatefulComponent(instance)</span><br><span class="line">  initProps(instance, props, isStateful, isSSR)</span><br><span class="line">  initSlots(instance, children)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> setupResult = isStateful</span><br><span class="line">    ? setupStatefulComponent(instance, isSSR)</span><br><span class="line">    : <span class="literal">undefined</span></span><br><span class="line">  isInSSRComponentSetup = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">return</span> setupResult</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-3-æå–-setupå‡½æ•°"><a href="#2-3-æå–-setupå‡½æ•°" class="headerlink" title="2.3 æå–  setupå‡½æ•°"></a>2.3 æå– <code> setup</code>å‡½æ•°</h5><p>åœ¨è¿™é‡Œé€šè¿‡ <code>const &#123; setup &#125; = Component</code>æ‹¿åˆ° è¯¥å‡½æ•°ï¼Œçœ‹åˆ°è¿™æ®µä»£ç ä¹Ÿå°±èƒ½å¾—å‡ºä¸€ä¸ªç»“è®º</p>
<ul>
<li>å¦‚æœå®ç°äº† setupå‡½æ•°ï¼Œé‚£ä¹ˆé€šè¿‡vue2 options api æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„</li>
<li>vue3æ˜¯å…¼å®¹ vue2  options api</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. call setup()</span></span><br><span class="line"><span class="comment">// åœ¨è¿™é‡Œå¼€å§‹å¤„ç† setup()å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> &#123; setup &#125; = Component</span><br><span class="line"><span class="keyword">if</span> (setup) &#123;</span><br><span class="line">  <span class="keyword">const</span> setupContext = (instance.setupContext =</span><br><span class="line">  setup.length &gt; <span class="number">1</span> ? createSetupContext(instance) : <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  currentInstance = instance</span><br><span class="line">  pauseTracking()</span><br><span class="line">  <span class="keyword">const</span> setupResult = callWithErrorHandling(</span><br><span class="line">    setup,</span><br><span class="line">    instance,</span><br><span class="line">    ErrorCodes.SETUP_FUNCTION,</span><br><span class="line">    [__DEV__ ? shallowReadonly(instance.props) : instance.props, setupContext]</span><br><span class="line">  )</span><br><span class="line">  resetTracking()</span><br><span class="line">  currentInstance = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isPromise(setupResult)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isSSR) &#123;</span><br><span class="line">      <span class="comment">// return the promise so server-renderer can wait on it</span></span><br><span class="line">    <span class="keyword">return</span> setupResult</span><br><span class="line">    .then(<span class="function">(<span class="params">resolvedResult: unknown</span>) =&gt;</span> &#123;</span><br><span class="line">       handleSetupResult(instance, resolvedResult, isSSR)</span><br><span class="line">      &#125;)</span><br><span class="line">     .catch(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">       handleError(e, instance, ErrorCodes.SETUP_FUNCTION)</span><br><span class="line">      &#125;)</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (__FEATURE_SUSPENSE__) &#123;</span><br><span class="line">      <span class="comment">// async setup returned Promise.</span></span><br><span class="line">      <span class="comment">// bail here and wait for re-entry.</span></span><br><span class="line">      instance.asyncDep = setupResult</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      warn(</span><br><span class="line">          <span class="string">`setup() returned a Promise, but the version of Vue you are using `</span> +</span><br><span class="line">            <span class="string">`does not support it yet.`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     handleSetupResult(instance, setupResult, isSSR)</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    finishComponentSetup(instance, isSSR) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-4-ç»Ÿä¸€æ‰§è¡Œ-callWithErrorHandling-å‡½æ•°"><a href="#2-4-ç»Ÿä¸€æ‰§è¡Œ-callWithErrorHandling-å‡½æ•°" class="headerlink" title="2.4 ç»Ÿä¸€æ‰§è¡Œ  callWithErrorHandling å‡½æ•°"></a>2.4 ç»Ÿä¸€æ‰§è¡Œ <code> callWithErrorHandling</code> å‡½æ•°</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">callWithErrorHandling</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  fn: <span class="built_in">Function</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  instance: ComponentInternalInstance | <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  type: ErrorTypes,</span></span></span><br><span class="line"><span class="function"><span class="params">  args?: unknown[]</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> res</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    res = args ? fn(...args) : fn()</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    handleError(err, instance, type)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°å…¶å®æœ¬è´¨å°±æ˜¯è‡ªå·±å°è£…äº†ä¸€ä¸ª try catch ï¼Œåœ¨å…¶å†…éƒ¨æ¥æ¥è°ƒ fn</p>
<h3 id="ä¸‰ã€ç»“è®º"><a href="#ä¸‰ã€ç»“è®º" class="headerlink" title="ä¸‰ã€ç»“è®º"></a>ä¸‰ã€ç»“è®º</h3><ul>
<li>ç»“åˆæºç ä¸€åˆ†æï¼Œå°±å¾ˆç¡®å®š æ‰§è¡Œ <code>setup</code> æ—¶ï¼Œç»„ä»¶å®ä¾‹ <code>å·²ç»åˆ›å»º</code>ï¼Œå®˜æ–¹æè¿°æ˜¯æœ‰é—®é¢˜çš„~</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/io/tags/Vue/">Vue</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/io/2021/06/18/Mixinåˆå¹¶è§„åˆ™/"><span>Mixinåˆå¹¶è§„åˆ™</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/io/2021/06/18/Mixinåˆå¹¶è§„åˆ™/" rel="bookmark">
        <time class="entry-date published" datetime="2021-06-18T02:41:53.000Z">
          2021-06-18
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="Mixinåˆå¹¶è§„åˆ™"><a href="#Mixinåˆå¹¶è§„åˆ™" class="headerlink" title="Mixinåˆå¹¶è§„åˆ™"></a>Mixinåˆå¹¶è§„åˆ™</h2><h3 id="Mixin-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Mixin-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Mixin æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Mixin æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul>
<li><p>å®˜æ–¹å®šä¹‰ ï¼š</p>
<p>Mixin æä¾›äº†ä¸€ç§éå¸¸çµæ´»çš„æ–¹å¼ï¼Œæ¥åˆ†å‘ Vue ç»„ä»¶ä¸­çš„å¯å¤ç”¨åŠŸèƒ½ã€‚ä¸€ä¸ª mixin å¯¹è±¡å¯ä»¥åŒ…å«ä»»æ„ç»„ä»¶é€‰é¡¹ã€‚å½“ç»„ä»¶ä½¿ç”¨ mixin å¯¹è±¡æ—¶ï¼Œæ‰€æœ‰ mixin å¯¹è±¡çš„é€‰é¡¹å°†è¢«â€œæ··åˆâ€è¿›å…¥è¯¥ç»„ä»¶æœ¬èº«çš„é€‰é¡¹ã€‚</p>
</li>
</ul>
<h3 id="é€‰é¡¹åˆå¹¶è§„åˆ™ï¼Ÿ"><a href="#é€‰é¡¹åˆå¹¶è§„åˆ™ï¼Ÿ" class="headerlink" title="é€‰é¡¹åˆå¹¶è§„åˆ™ï¼Ÿ"></a>é€‰é¡¹åˆå¹¶è§„åˆ™ï¼Ÿ</h3><p>æ¢ç´¢åæ€»ç»“å‡ºä¸‰ä¸ªç‚¹</p>
<h4 id="ä¸€ã€dataå‡½æ•°è¿”å›å€¼å¯¹è±¡"><a href="#ä¸€ã€dataå‡½æ•°è¿”å›å€¼å¯¹è±¡" class="headerlink" title="ä¸€ã€dataå‡½æ•°è¿”å›å€¼å¯¹è±¡"></a>ä¸€ã€dataå‡½æ•°è¿”å›å€¼å¯¹è±¡</h4><ul>
<li>é»˜è®¤æƒ…å†µä¸‹ä¼šè¿›è¡Œåˆå¹¶</li>
<li>è¿”å›å€¼å¯¹è±¡å¦‚æœå­˜åœ¨å†²çªï¼Œä¼šä»¥ç»„ä»¶è‡ªèº«çš„æ•°æ®ä¸ºä¼˜å…ˆ</li>
</ul>
<p>ä»£ç ä½è¯ï¼š</p>
<p>åœ¨ Mixin å¯¹è±¡ä¸­å®šä¹‰äº† Message å±æ€§ï¼Œåœ¨ App.vue ä¸­ä¹Ÿå®šä¹‰äº† Message å±æ€§</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de2c3ace22bb42529af2aa62af37f6b4~tplv-k3u1fbpfcp-watermark.image" alt="darcula-4x.png"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a513e872f4f043e8b087671c55d743e8~tplv-k3u1fbpfcp-watermark.image" alt="darcula-4x (1).png"></p>
<p>ç»“æœä¸å‡ºæ„æ–™çš„ä¼šæ˜¾ç¤º <code> Node.jsæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€</code> </p>
<h4 id="äºŒã€ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°"><a href="#äºŒã€ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°" class="headerlink" title="äºŒã€ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°"></a>äºŒã€ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°</h4><ul>
<li>é’©å­å‡½æ•°ä¼šè¢«åˆå¹¶åˆ°æ•°ç»„ä¸­ï¼Œåœ¨åˆé€‚çš„æ—¶æœºéƒ½ä¼šè¢«è°ƒç”¨</li>
</ul>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7a305c624f240fb8242c2c9b53a3e7c~tplv-k3u1fbpfcp-watermark.image" alt="é’©å­å‡½æ•°.png"></p>
<p>é€šè¿‡ä»£ç æ‰§è¡Œç»“æœä¹Ÿæ˜¯éªŒè¯äº†è¿™ä¸ªç»“è®ºï¼Œæœ‰å…´è¶£å¯ä»¥è¯»vue-nextæºç ï¼Œå®ƒé‡Œé¢æœ¬è´¨å°±æ˜¯è¿™æ ·åšçš„ã€‚</p>
<h4 id="ä¸‰ã€å¯¹è±¡ç±»å‹"><a href="#ä¸‰ã€å¯¹è±¡ç±»å‹" class="headerlink" title="ä¸‰ã€å¯¹è±¡ç±»å‹"></a>ä¸‰ã€å¯¹è±¡ç±»å‹</h4><ul>
<li>å¦‚æœéƒ½æœ‰methodsé€‰é¡¹ä¸”å®šä¹‰äº†å®ç°ï¼Œé‚£ä¹ˆéƒ½ä¼šç”Ÿæ•ˆ</li>
<li>å¦‚æœå¯¹è±¡çš„keyç›¸åŒï¼Œåˆ™åªä¼šå–ç»„ä»¶å¯¹è±¡çš„é”®å€¼å¯¹</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/io/tags/Vue/">Vue</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/io/2021/05/24/é‚‚é€… woker/"><span>é‚‚é€…CLIå¼€å‘-wokerå¼€å‘è¿‡ç¨‹</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/io/2021/05/24/é‚‚é€… woker/" rel="bookmark">
        <time class="entry-date published" datetime="2021-05-24T07:55:53.000Z">
          2021-05-24
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="é‚‚é€…CLIå¼€å‘-wokerå¼€å‘è¿‡ç¨‹"><a href="#é‚‚é€…CLIå¼€å‘-wokerå¼€å‘è¿‡ç¨‹" class="headerlink" title="é‚‚é€…CLIå¼€å‘-wokerå¼€å‘è¿‡ç¨‹"></a>é‚‚é€…CLIå¼€å‘-wokerå¼€å‘è¿‡ç¨‹</h2><p>åœ¨å‰ç«¯å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å„ç§å„æ ·çš„è„šæ‰‹æ¶ vue-cliã€create-react-appç­‰å·¥å…·ã€‚</p>
<p>è¿™äº›å·¥å…·æ˜¯æ€ä¹ˆå¼€å‘å‡ºæ¥çš„ï¼Ÿå½“æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªå‘½ä»¤å…¶å†…éƒ¨å¸®æˆ‘ä»¬å¤„ç†äº†å“ªäº›äº‹æƒ…ï¼Ÿ</p>
<p>æœ€è¿‘å†™äº†ä¸€ä¸ªå« woker çš„å°å·¥å…·ï¼Œè®°å½•ä¸‹å…¶å¼€å‘è¿‡ç¨‹ã€‚æ–‡æ¡£ä¼šåˆ†æˆä¸¤éƒ¨åˆ†</p>
<blockquote>
<p>CLI è„šæ‰‹æ¶å¼€å‘è¿‡ç¨‹ï¼› </p>
</blockquote>
<blockquote>
<p>woker ä½¿ç”¨ä»‹ç»ï¼›</p>
<blockquote>
<p>Vue é¡¹ç›®æ¨¡æ¿ï¼š<a target="_blank" rel="noopener" href="https://github.com/coderx-waper/z-vue-template">https://github.com/coderx-waper/z-vue-template</a></p>
<p>è„šæ‰‹æ¶åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/coderx-waper/woker">https://github.com/coderx-waper/woker</a> </p>
</blockquote>
</blockquote>
<p>å¦‚å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ä¸€é”®ä¸‰è”~ ç‚¹ä¸ª star è¿˜æ˜¯è¦ æ±‚ä¸€ä¸‹çš„ğŸ˜¬ </p>
<hr>
<h3 id="å¼€å‘è¿‡ç¨‹"><a href="#å¼€å‘è¿‡ç¨‹" class="headerlink" title="å¼€å‘è¿‡ç¨‹"></a>å¼€å‘è¿‡ç¨‹</h3><h4 id="ä¸€ã€é¡¹ç›®å¼€å§‹"><a href="#ä¸€ã€é¡¹ç›®å¼€å§‹" class="headerlink" title="ä¸€ã€é¡¹ç›®å¼€å§‹"></a>ä¸€ã€é¡¹ç›®å¼€å§‹</h4><ul>
<li><p>åˆ›å»ºç©ºæ–‡ä»¶å¤¹ ä½œä¸ºæˆ‘ä»¬é¡¹ç›®çš„å­˜æ”¾ä½ç½® </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¾‹å¦‚ï¼šcd woker</span><br></pre></td></tr></table></figure></li>
<li><p>åˆ›å»º package.jsonæ–‡ä»¶</p>
<p>åœ¨ç»ˆç«¯æ‰§è¡Œ<code>  npm init -y</code> ï¼Œå³å¯ç”Ÿæˆ  package.json æ–‡ä»¶</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;woker&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;vue-cli&quot;</span>,</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;bin&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;woker&quot;</span>: <span class="string">&quot;index.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;keywords&quot;</span>: [<span class="string">&quot;vue-cli&quot;</span>,<span class="string">&quot;coderz&quot;</span>,<span class="string">&quot;vue&quot;</span>,<span class="string">&quot;woker&quot;</span>],</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;coderz&quot;</span>, </span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">  <span class="string">&quot;homepage&quot;</span>: <span class="string">&quot;https://github.com/coderx-waper/woker.git&quot;</span>,</span><br><span class="line">  <span class="string">&quot;repository&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;git&quot;</span>,</span><br><span class="line">    <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://github.com/coderx-waper/woker.git&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;commander&quot;</span>: <span class="string">&quot;^7.2.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;download-git-repo&quot;</span>: <span class="string">&quot;^3.0.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ejs&quot;</span>: <span class="string">&quot;^3.1.6&quot;</span>,</span><br><span class="line">    <span class="string">&quot;inquirer&quot;</span>: <span class="string">&quot;^8.0.0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>é…ç½®æ–‡ä»¶å¤¹</p>
<p>æœ€ç»ˆ woker é¡¹ç›®ä¸­æ–‡ä»¶ç›®å½•ç»“æ„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ lib</span><br><span class="line">| â”œâ”€â”€ config <span class="comment">// é…ç½®æ–‡ä»¶</span></span><br><span class="line">â”‚ â”‚   â””â”€â”€ repo_config.js</span><br><span class="line">| â”œâ”€â”€ core <span class="comment">// æ ¸å¿ƒæ–‡ä»¶</span></span><br><span class="line">â”‚ â”‚   â”œâ”€â”€ react <span class="comment">// å¾…å¢åŠ ... </span></span><br><span class="line">â”‚ â”‚   â”œâ”€â”€ vue</span><br><span class="line">â”‚ â”‚   â”œâ”€â”€ â””â”€â”€ action.js</span><br><span class="line">â”‚ â”‚   â”œâ”€â”€ â””â”€â”€ create.js </span><br><span class="line">â”‚ â”‚   â”œâ”€â”€ â””â”€â”€ help.js</span><br><span class="line">| â”œâ”€â”€ templates <span class="comment">// ejs æ¨¡æ¿æ–‡ä»¶</span></span><br><span class="line">â”‚ â”‚   â””â”€â”€ vue-component.ejs</span><br><span class="line">â”‚ â”‚   â””â”€â”€ vue-router.ejs</span><br><span class="line">â”‚ â”‚   â””â”€â”€ vue-store.ejs</span><br><span class="line">â”‚ â”‚   â””â”€â”€ vue-types.ejs</span><br><span class="line">| â”œâ”€â”€ untils <span class="comment">// </span></span><br><span class="line">â”‚ â”‚   â””â”€â”€ terminal.js</span><br><span class="line">â”‚ â”‚   â””â”€â”€ utils.js</span><br><span class="line">â”œâ”€â”€ index.js</span><br><span class="line">â”œâ”€â”€ package-lock.json</span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â”œâ”€â”€ README.md</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="äºŒã€åˆ›å»ºå‘½ä»¤"><a href="#äºŒã€åˆ›å»ºå‘½ä»¤" class="headerlink" title="äºŒã€åˆ›å»ºå‘½ä»¤"></a>äºŒã€åˆ›å»ºå‘½ä»¤</h4><p>å¿…é¡»æ³¨æ„ä¸€ç‚¹ ï¼Œè¿™æ®µä»£ç å¿…é¡»æ”¾åœ¨ index.js æ–‡ä»¶çš„æœ€ä¸Šé¢</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env node</span></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ package.json æ–‡ä»¶</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;bin&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;woker&quot;</span>: <span class="string">&quot;index.js&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œ <code> npm link</code>   woker æ‰ä¼šç”Ÿæ•ˆ</p>
<p>åˆ›å»ºå‘½ä»¤éœ€è¦å€ŸåŠ©<code> commander</code> åº“æ¥å®ç°ï¼Œç”¨æ³•å¯è‡ªè¡Œå‚è€ƒå®˜ç½‘<a target="_blank" rel="noopener" href="https://github.com/tj/commander.js/blob/HEAD/Readme_zh-CN.md"><code> commander</code></a></p>
<h4 id="ä¸‰ã€åˆ›å»ºé¡¹ç›®æŒ‡ä»¤"><a href="#ä¸‰ã€åˆ›å»ºé¡¹ç›®æŒ‡ä»¤" class="headerlink" title="ä¸‰ã€åˆ›å»ºé¡¹ç›®æŒ‡ä»¤"></a>ä¸‰ã€åˆ›å»ºé¡¹ç›®æŒ‡ä»¤</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">program.command(<span class="string">&#x27;create &lt;project&gt; [others...]&#x27;</span>)</span><br><span class="line">        .description(<span class="string">&#x27;clone repo into a folder&#x27;</span>)</span><br><span class="line">        .action(createVueProjectAction)</span><br></pre></td></tr></table></figure>

<p><code>createVueProjectAction</code> æ˜¯å°è£…åœ¨ action.js æ–‡ä»¶ä¸­çš„ä¸€ä¸ªåŠ¨ä½œï¼Œåœ¨actionä¸­çš„åˆ›å»ºè¿‡ç¨‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a vue template action</span></span><br><span class="line"><span class="keyword">const</span> createVueProjectAction = <span class="keyword">async</span> (project, others) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(project, others)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1 clone project</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;coderz helps you clone a vue template, this requires a budget...&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> download(vuerepo, project, &#123;</span><br><span class="line">        clone: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2 npm install</span></span><br><span class="line">    <span class="keyword">const</span> commandTerminal = process.platform === <span class="string">&#x27;win32&#x27;</span> ? <span class="string">&#x27;npm.cmd&#x27;</span> : <span class="string">&#x27;npm&#x27;</span></span><br><span class="line">    <span class="keyword">await</span> commandSpawn(commandTerminal, [<span class="string">&#x27;install&#x27;</span>], &#123;</span><br><span class="line">        cwd: <span class="string">`./<span class="subst">$&#123;project&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 3 run serve</span></span><br><span class="line">    commandSpawn(commandTerminal, [<span class="string">&#x27;run&#x27;</span>, <span class="string">&#x27;serve&#x27;</span>], &#123;</span><br><span class="line">        cwd: <span class="string">`./<span class="subst">$&#123;project&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4 z-vue-template install it --open </span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ¶‰åŠå‡ ä¸ªå‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>download ï¼šå¯ä»¥è¿›è¡Œ clone çš„ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“<code> download-git-repo</code>  å¯è‡ªè¡Œåœ¨ npm ä¸­æŸ¥çœ‹å…¶ç”¨æ³•</li>
<li>commandSpawnï¼šæ‰§è¡Œç»ˆç«¯å‘½ä»¤çš„å‡½æ•° å¯åœ¨ terminal.js æ–‡ä»¶ä¸­æ‰¾åˆ°å…¶å®ç°æ–¹æ³•</li>
<li>vuerepoï¼švue-template æ¨¡æ¿åœ°å€ï¼Œå°è£…åœ¨ lib/config/repo-config.js ä¸­ï¼Œåç»­è€ƒè™‘å¯è‡ªå®šä¹‰æ¨¡æ¿åœ°å€ï¼Œç›®å‰ä½¿ç”¨è‡ªå·±å†™çš„  <code> z-vue-template</code></li>
</ul>
<h4 id="å››ã€æ·»åŠ ç»„ä»¶æŒ‡ä»¤"><a href="#å››ã€æ·»åŠ ç»„ä»¶æŒ‡ä»¤" class="headerlink" title="å››ã€æ·»åŠ ç»„ä»¶æŒ‡ä»¤"></a>å››ã€æ·»åŠ ç»„ä»¶æŒ‡ä»¤</h4><p>æ·»åŠ æŒ‡ä»¤</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">program.command(<span class="string">&#x27;addcpn &lt;name&gt;&#x27;</span>)</span><br><span class="line">        .description(<span class="string">&#x27;add vue component, eg: addcpn NavBar [-d src/components]&#x27;</span>)</span><br><span class="line">        .action(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">            addComponentAction(name, program.dest || <span class="string">&#x27;src/components&#x27;</span>)</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>addComponentAction é€»è¾‘</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create component action</span></span><br><span class="line"><span class="keyword">const</span> addComponentAction = <span class="keyword">async</span> (name, dest) =&gt; &#123;</span><br><span class="line">    <span class="comment">// needs ejs template -&gt;  .vue </span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> compile(<span class="string">&#x27;vue-component.ejs&#x27;</span>, &#123;</span><br><span class="line">        name,</span><br><span class="line">        lowerName: name.toLowerCase()</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// write to source folder</span></span><br><span class="line">    <span class="keyword">const</span> targetPath = path.resolve(dest || <span class="string">&#x27;src/components&#x27;</span>, <span class="string">`<span class="subst">$&#123;name&#125;</span>.vue`</span>)</span><br><span class="line">    writeFile(targetPath, result)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œé¢å­˜åœ¨ä¸€ä¸ªé—®é¢˜å³åˆ›å»ºå½“æ–‡ä»¶å¤¹ä¸å­˜çš„æ—¶ï¼Œåˆ›å»ºä¼šå‡ºé”™ï¼Œæ•…è€Œåœ¨è°ƒç”¨ writeFile ä¸­è¿›è¡Œäº†æ–‡ä»¶å¤¹çš„é€’å½’è°ƒç”¨æ ¹æ®targetPathåˆ›å»ºå¯¹åº”æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­çš„å®ç°é€»è¾‘ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mkdirSync = <span class="function">(<span class="params">dirname</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (fs.existsSync(dirname)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸å­˜åœ¨,åˆ¤æ–­ä¸Šä¸€çº§æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼Ÿ</span></span><br><span class="line">        <span class="keyword">if</span> (mkdirSync(path.dirname(dirname))) &#123;</span><br><span class="line">            <span class="comment">// å­˜åœ¨çˆ¶æ–‡ä»¶ï¼Œå°±ç›´æ¥æ–°å»ºè¯¥æ–‡ä»¶</span></span><br><span class="line">            fs.mkdirSync(dirname)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ·»åŠ ç»„ä»¶éœ€è¦å»äº†è§£<code> ejs</code>ç”¨æ³•ï¼Œé¡¹ç›®ä¸­å·²ç»æ ¹æ®éœ€è¦æå‰å†™å¥½äº†<code>vue-component.ejs</code>æ¨¡æ¿</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;&lt;%= data.lowerName %&gt;&quot;</span>&gt;</span><br><span class="line">    &lt;h2&gt;&#123;&#123; message &#125;&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">&quot;&lt;%= data.name %&gt;&quot;</span>,</span><br><span class="line">    components: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    mixins: [],</span><br><span class="line">    props: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    data: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        message: <span class="string">&quot;Hello &lt;%= data.name %&gt;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">  .&lt;%= data.lowerName %&gt; &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>æ¨¡æ¿ejs ç¼–è¯‘æ ¸å¿ƒï¼šéœ€è¦ä½¿ç”¨åˆ° <code>ejs</code> åº“</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**ç¼–è¯‘æ–‡ä»¶ */</span></span><br><span class="line"><span class="keyword">const</span> compile = <span class="function">(<span class="params">template, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è·å– è·¯å¾„</span></span><br><span class="line">    <span class="keyword">const</span> temp = <span class="string">`../templates/<span class="subst">$&#123;template&#125;</span>`</span></span><br><span class="line">    <span class="keyword">const</span> temPath = path.resolve(__dirname, temp)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        ejs.renderFile(temPath, &#123;</span><br><span class="line">            data</span><br><span class="line">        &#125;, &#123;&#125;, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                reject(err)</span><br><span class="line">            &#125;</span><br><span class="line">            resolve(result)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="äº”-ã€æ·»åŠ å…¶ä»–æŒ‡ä»¤"><a href="#äº”-ã€æ·»åŠ å…¶ä»–æŒ‡ä»¤" class="headerlink" title="äº” ã€æ·»åŠ å…¶ä»–æŒ‡ä»¤"></a>äº” ã€æ·»åŠ å…¶ä»–æŒ‡ä»¤</h4><p>æ·»åŠ  pageæŒ‡ä»¤å’Œ store æŒ‡ä»¤åŒä¸Šï¼Œé€»è¾‘å¯ä»¥æŸ¥çœ‹ woker ä¸­çš„å®ç°ã€‚è¿™é‡Œä¸å†ç´¯è¿°ã€‚</p>
<h4 id="å…­ã€å‘å¸ƒåˆ°npm"><a href="#å…­ã€å‘å¸ƒåˆ°npm" class="headerlink" title="å…­ã€å‘å¸ƒåˆ°npm"></a>å…­ã€å‘å¸ƒåˆ°npm</h4><p>åœ¨å‘å¸ƒä¹‹å‰ï¼Œæ‰€æœ‰æŒ‡ä»¤å¿…é¡»æµ‹è¯•æ— é—®é¢˜</p>
<p>ä¿®æ”¹package.jsonï¼šæ·»åŠ  homepageã€repository</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;homepage&quot;</span>: <span class="string">&quot;https://github.com/coderx-waper/woker.git&quot;</span>, <span class="comment">//æ­¤å¤„å¡«å†™ä½ çš„ homepage</span></span><br><span class="line"><span class="string">&quot;repository&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;git&quot;</span>,</span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://github.com/coderx-waper/woker.git&quot;</span> <span class="comment">//æ­¤å¤„å¡«å†™ä½ çš„ repository</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>åœ¨å‘½ä»¤è¡Œä¸­ç™»å½•ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm login <span class="comment">//æ ¹æ®æç¤ºè¾“å…¥ä¿¡æ¯å³å¯</span></span><br></pre></td></tr></table></figure>

<p>å‘å¸ƒåˆ°npm registryä¸­</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm publish</span><br></pre></td></tr></table></figure>



<h2 id="wokerä½¿ç”¨ä»‹ç»"><a href="#wokerä½¿ç”¨ä»‹ç»" class="headerlink" title="wokerä½¿ç”¨ä»‹ç»"></a>wokerä½¿ç”¨ä»‹ç»</h2><ul>
<li><p>woker æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>Front-end scaffolding, currently supports vue</p>
</li>
<li><p>åç»­æ‰“ç®—ï¼Ÿ</p>
<p> æ”¯æŒ æ”¯æŒ react template</p>
</li>
</ul>
<p>å¦‚ä½•å®‰è£…ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g woker</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h3><p>ç›®å‰<code>woker</code>ä»…æ”¯æŒvueï¼Œcliå·²ç»å¸®ä½ é…ç½®äº†</p>
<ul>
<li>å¸¸ç”¨çš„ç›®å½•ç»“æ„</li>
<li>axios </li>
<li>vue-router</li>
<li>vuex</li>
<li>vue.config.js<br>åˆ›å»ºé¡¹ç›®</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">woker create &lt;project&gt;[^project]: ä½ çš„é¡¹ç›®åç§° ä¾‹å¦‚ï¼š woker create demo</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è‡ªåŠ¨æ‹‰å–z-vue-templateé¡¹ç›®æ¨¡æ¿ï¼Œè‡ªåŠ¨æ‰“å¼€ <code>http://localhost:8080/</code>ã€å¯åŠ¨é¡¹ç›®</p>
<h3 id="åˆ›å»ºç»„ä»¶"><a href="#åˆ›å»ºç»„ä»¶" class="headerlink" title="åˆ›å»ºç»„ä»¶"></a>åˆ›å»ºç»„ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">woker addcpn &lt;component&gt;[^component]: ä½ çš„ç»„ä»¶åç§° ä¾‹å¦‚ï¼š woker addcpn HelloWold</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºé¡µé¢"><a href="#åˆ›å»ºé¡µé¢" class="headerlink" title="åˆ›å»ºé¡µé¢"></a>åˆ›å»ºé¡µé¢</h3><p>åˆ›å»ºé¡µé¢è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨é…ç½®è·¯ç”±</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">woker addpage &lt;profile&gt;[^profile]: ä½ çš„é¡µé¢åç§° ä¾‹å¦‚ï¼š woker addpage profile</span><br></pre></td></tr></table></figure>

<h2 id=""><a href="#" class="headerlink" title=""></a></h2>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/io/tags/NodeJs/">NodeJs</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/io/2021/05/21/nodejs-express/"><span>express</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/io/2021/05/21/nodejs-express/" rel="bookmark">
        <time class="entry-date published" datetime="2021-05-21T03:30:00.000Z">
          2021-05-21
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="express"><a href="#express" class="headerlink" title="express"></a>express</h1><p>æœ¬èŠ‚ä¸€èµ·æ¥æ¢ç©¶nodeä¸­å¸¸ç”¨çš„<code>express</code>æ ¸å¿ƒä¸­çš„5ä¸ªé—®é¢˜</p>
<h3 id="1-è°ƒç”¨-express-åˆ°åº•åˆ›å»ºäº†ä»€ä¹ˆâ“"><a href="#1-è°ƒç”¨-express-åˆ°åº•åˆ›å»ºäº†ä»€ä¹ˆâ“" class="headerlink" title="1. è°ƒç”¨ express() åˆ°åº•åˆ›å»ºäº†ä»€ä¹ˆâ“"></a>1. è°ƒç”¨ express() åˆ°åº•åˆ›å»ºäº†ä»€ä¹ˆâ“</h3><p>æ‰“å¼€express coreçš„ lib/express.js ä¼šå‘ç°æœ‰è¿™ä¹ˆä¸€æ®µä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span> = <span class="built_in">module</span>.exports = createApplication;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createApplication</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> app = <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    app.handle(req, res, next);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  mixin(app, EventEmitter.prototype, <span class="literal">false</span>);</span><br><span class="line">  mixin(app, proto, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// expose the prototype that will get set on requests</span></span><br><span class="line">  app.request = <span class="built_in">Object</span>.create(req, &#123;</span><br><span class="line">    app: &#123; <span class="attr">configurable</span>: <span class="literal">true</span>, <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">writable</span>: <span class="literal">true</span>, <span class="attr">value</span>: app &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// expose the prototype that will get set on responses</span></span><br><span class="line">  app.response = <span class="built_in">Object</span>.create(res, &#123;</span><br><span class="line">    app: &#123; <span class="attr">configurable</span>: <span class="literal">true</span>, <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">writable</span>: <span class="literal">true</span>, <span class="attr">value</span>: app &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  app.init();</span><br><span class="line">  <span class="keyword">return</span> app;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜æ˜¾åœ¨è°ƒç”¨ express()æœ¬è´¨æ˜¯æ‰§è¡Œäº†ä¸€æ®µ <code>createApplication</code> å‡½æ•°</p>
<h3 id="2-app-listen-åšäº†å“ªäº›äº‹æƒ…â“"><a href="#2-app-listen-åšäº†å“ªäº›äº‹æƒ…â“" class="headerlink" title="2. app.listen()åšäº†å“ªäº›äº‹æƒ…â“"></a>2. app.listen()åšäº†å“ªäº›äº‹æƒ…â“</h3><p>è¿™é‡Œä½ å¯èƒ½ä¼šæœ‰ä¸¤ä¸ªç–‘é—®ï¼š</p>
<h4 id="2-1-appä¸æ˜¯ä¸€ä¸ªå‡½æ•°å—â“ä¸ºä»€ä¹ˆå¯ä»¥å»è°ƒç”¨-listen"><a href="#2-1-appä¸æ˜¯ä¸€ä¸ªå‡½æ•°å—â“ä¸ºä»€ä¹ˆå¯ä»¥å»è°ƒç”¨-listen" class="headerlink" title="2.1 appä¸æ˜¯ä¸€ä¸ªå‡½æ•°å—â“ä¸ºä»€ä¹ˆå¯ä»¥å»è°ƒç”¨ listen"></a>2.1 appä¸æ˜¯ä¸€ä¸ªå‡½æ•°å—â“ä¸ºä»€ä¹ˆå¯ä»¥å»è°ƒç”¨ <code>listen</code></h4><p>appè™½ç„¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ•…è€Œå¯ä»¥å»è°ƒç”¨ listen</p>
<h4 id="2-2-åœ¨createApplicationä¸­å¹¶æ²¡æœ‰å‘ç°appä¸­æœ‰listenå‡½æ•°"><a href="#2-2-åœ¨createApplicationä¸­å¹¶æ²¡æœ‰å‘ç°appä¸­æœ‰listenå‡½æ•°" class="headerlink" title="2.2 åœ¨createApplicationä¸­å¹¶æ²¡æœ‰å‘ç°appä¸­æœ‰listenå‡½æ•°"></a>2.2 åœ¨createApplicationä¸­å¹¶æ²¡æœ‰å‘ç°appä¸­æœ‰listenå‡½æ•°</h4><p>appå¯ä»¥ç›´æ¥è°ƒç”¨listen è¿™é‡Œæœ‰ä¸€æ®µå¾ˆé‡è¦çš„å¤„ç†å³ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mixin(app, proto, <span class="literal">false</span>); <span class="comment">//åº•å±‚åšäº†æ··å…¥å¤„ç†</span></span><br></pre></td></tr></table></figure>
<p><code>proto</code> æœ¬è´¨æ˜¯ applicationï¼Œåœ¨ application.jsä¸­å…¶æœ¬è´¨å°±æ˜¯è°ƒç”¨äº†  http.createServer(this).listen æŠŠå‚æ•°å…¨éƒ¨ä¼ é€’äº†è¿‡æ¥;<br>ä¾æ®ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.listen = <span class="function"><span class="keyword">function</span> <span class="title">listen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> server = http.createServer(<span class="built_in">this</span>);</span><br><span class="line">  <span class="keyword">return</span> server.listen.apply(server, <span class="built_in">arguments</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-app-use-ä¸­é—´ä»¶-å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆâ“"><a href="#3-app-use-ä¸­é—´ä»¶-å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆâ“" class="headerlink" title="3. app.use(ä¸­é—´ä»¶)å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆâ“"></a>3. app.use(ä¸­é—´ä»¶)å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆâ“</h3><p>open application.js åœ¨ app.use = function use() å‡½æ•°ä¸­ç”Ÿæˆäº†ä¸€ä¸ªå…¨å±€è·¯ç”± routerï¼Œåœ¨ <code>var fns = flatten(slice.call(arguments, offset))</code> åšäº†æ‰å¹³å¤„ç†ï¼Œå°†æ‰€æœ‰å‡½æ•°èµ‹å€¼ç»™äº† fnsï¼Œæ¥ç€é€šè¿‡ fns.forEach()å–å‡ºæ¯ä¸€ä¸ªå‡½æ•°åœ¨228è¡Œæœ¬è´¨è°ƒç”¨äº† router.use()å‡½æ•°</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">router.use(path, <span class="function"><span class="keyword">function</span> <span class="title">mounted_app</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> orig = req.app;</span><br><span class="line">      fn.handle(req, res, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">        setPrototypeOf(req, orig.request)</span><br><span class="line">        setPrototypeOf(res, orig.response)</span><br><span class="line">        next(err);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="string">``</span><span class="string">``</span></span><br><span class="line">è·³åˆ°lib/router/index.jsä½ çš„ç–‘é—®å³å¯æ­æ™“ã€‚åœ¨å…¶åº•å±‚proto.use = <span class="function"><span class="keyword">function</span> <span class="title">use</span>(<span class="params">fn</span>)ä¸­ å…¶å®æ˜¯` <span class="title">new</span> <span class="title">Layer</span>(<span class="params"></span>)` ï¼Œç„¶åå°†ç”Ÿæˆçš„å›¾å±‚ <span class="title">layer</span> <span class="title">push</span>åˆ°äº† <span class="title">stack</span>ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ª <span class="title">stack</span>å°±æ˜¯åˆæœŸç»‘å®šåˆ°<span class="title">router</span>åŸå‹ä¸Šçš„ä¸€ä¸ª <span class="title">stack</span>æ•°ç»„ï¼Œ<span class="title">layer</span>ä¸­æˆ‘ä»¬çš„å›è°ƒå‡½æ•°ï¼Œ`<span class="title">this</span>.<span class="title">stack</span>.<span class="title">push</span>(<span class="params">layer</span>)`è¿™é‡Œçš„ <span class="title">this</span>æœ¬è´¨å°±æ˜¯<span class="title">router</span>å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">### 4. ç”¨æˆ·å‘é€äº†è¯·æ±‚ï¼Œä¸­é—´ä»¶æ˜¯æ€ä¹ˆè¢«å›è°ƒçš„â“</span></span><br><span class="line"><span class="function">å½“ä¸€ä¸ªè¯·æ±‚è¿‡æ¥åï¼Œåº•å±‚æœ¬è´¨æ˜¯å¤„ç†äº† <span class="title">router</span>ä¸­çš„<span class="title">handle</span>å‡½æ•° `<span class="title">router</span>.<span class="title">handle</span>(<span class="params">req, res, done</span>)</span>;<span class="string">` åœ¨ `</span>proto.handle()<span class="string">` å‡½æ•°ä¸­ é€šè¿‡self.stackæ‹¿åˆ°æˆ‘ä»¬çš„ stackï¼Œç¬¬ä¸€æ¬¡ä¸»åŠ¨è°ƒç”¨ next() æ ¸å¿ƒå‡½æ•°ï¼š</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line">  <span class="comment">// idx = 0 ; // init </span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> layerError = err === <span class="string">&#x27;route&#x27;</span></span><br><span class="line">      ? <span class="literal">null</span></span><br><span class="line">      : err;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// remove added slash</span></span><br><span class="line">    <span class="keyword">if</span> (slashAdded) &#123;</span><br><span class="line">      req.url = req.url.substr(<span class="number">1</span>);</span><br><span class="line">      slashAdded = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// restore altered req.url</span></span><br><span class="line">    <span class="keyword">if</span> (removed.length !== <span class="number">0</span>) &#123;</span><br><span class="line">      req.baseUrl = parentUrl;</span><br><span class="line">      req.url = protohost + removed + req.url.substr(protohost.length);</span><br><span class="line">      removed = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// signal to exit router</span></span><br><span class="line">    <span class="keyword">if</span> (layerError === <span class="string">&#x27;router&#x27;</span>) &#123;</span><br><span class="line">      setImmediate(done, <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// no more matching layers</span></span><br><span class="line">    <span class="keyword">if</span> (idx &gt;= stack.length) &#123;</span><br><span class="line">      setImmediate(done, layerError);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get pathname of request</span></span><br><span class="line">    <span class="keyword">var</span> path = getPathname(req);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (path == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> done(layerError);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// find next matching layer</span></span><br><span class="line">    <span class="keyword">var</span> layer;</span><br><span class="line">    <span class="keyword">var</span> match;</span><br><span class="line">    <span class="keyword">var</span> route;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (match !== <span class="literal">true</span> &amp;&amp; idx &lt; stack.length) &#123;</span><br><span class="line">      layer = stack[idx++];</span><br><span class="line">      match = matchLayer(layer, path);</span><br><span class="line">      route = layer.route;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> match !== <span class="string">&#x27;boolean&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// hold on to layerError</span></span><br><span class="line">        layerError = layerError || match;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (match !== <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!route) &#123;</span><br><span class="line">        <span class="comment">// process non-route handlers normally</span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (layerError) &#123;</span><br><span class="line">        <span class="comment">// routes do not match with a pending error</span></span><br><span class="line">        match = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> method = req.method;</span><br><span class="line">      <span class="keyword">var</span> has_method = route._handles_method(method);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// build up automatic options response</span></span><br><span class="line">      <span class="keyword">if</span> (!has_method &amp;&amp; method === <span class="string">&#x27;OPTIONS&#x27;</span>) &#123;</span><br><span class="line">        appendMethods(options, route._options());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// don&#x27;t even bother matching route</span></span><br><span class="line">      <span class="keyword">if</span> (!has_method &amp;&amp; method !== <span class="string">&#x27;HEAD&#x27;</span>) &#123;</span><br><span class="line">        match = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// no match</span></span><br><span class="line">    <span class="keyword">if</span> (match !== <span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> done(layerError);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// store route for dispatch on change</span></span><br><span class="line">    <span class="keyword">if</span> (route) &#123;</span><br><span class="line">      req.route = route;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Capture one-time layer values</span></span><br><span class="line">    req.params = self.mergeParams</span><br><span class="line">      ? mergeParams(layer.params, parentParams)</span><br><span class="line">      : layer.params;</span><br><span class="line">    <span class="keyword">var</span> layerPath = layer.path;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// this should be done for the layer</span></span><br><span class="line">    self.process_params(layer, paramcalled, req, res, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> next(layerError || err);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (route) &#123;</span><br><span class="line">        <span class="keyword">return</span> layer.handle_request(req, res, next);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      trim_prefix(layer, layerError, layerPath, path);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>æ‰¾åˆ°ä¹‹ååˆè°ƒç”¨äº† layer çš„<code>handle_request()</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åˆåœ¨å¤„ç†ä»€ä¹ˆå‘¢ï¼Ÿæ¥ç€å¾€ä¸‹çœ‹ã€‚å…¶å®ä»–åšçš„äº‹æƒ…æœ¬è´¨ä¸Šæ˜¯è°ƒç”¨æ ¸å¿ƒ<code>fn(req, res, next);</code><br>fnæ˜¯ä»€ä¹ˆ?<br>fnå°±æ˜¯ä» layerä¸­å–å‡ºçš„ <code>handle</code></p>
<h3 id="5-nextä¸ºä»€ä¹ˆä¼šè‡ªåŠ¨æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶â“"><a href="#5-nextä¸ºä»€ä¹ˆä¼šè‡ªåŠ¨æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶â“" class="headerlink" title="5. nextä¸ºä»€ä¹ˆä¼šè‡ªåŠ¨æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶â“"></a>5. nextä¸ºä»€ä¹ˆä¼šè‡ªåŠ¨æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶â“</h3><p>ç†è§£äº†ç¬¬4ä¸ªé—®é¢˜æµç¨‹ï¼Œå½“æˆ‘ä»¬è‡ªå·±æ³¨å†Œäº†ä¸­é—´ä»¶ï¼Œè°ƒç”¨äº† next() æ¡†æ¶åº•å±‚å°±ä¼šæ¥åˆ°next()åŒ¹é…ä¸‹ä¸€ä¸ªstackè¿›è¡Œlayerçš„æ‰§è¡Œ</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/io/tags/NodeJs/">NodeJs</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/io/2021/04/09/ofiios/"><span>ofiios</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/io/2021/04/09/ofiios/" rel="bookmark">
        <time class="entry-date published" datetime="2021-04-09T09:38:59.000Z">
          2021-04-09
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>åå­—æ²¡æƒ³å¥½ï¼Œå°±æš‚ä¸”å«å®ƒ   <a target="_blank" rel="noopener" href="https://github.com/coderx-waper/ofiios.git">ofiios</a></p>
<h3 id="å†™-ofiios-åŠ¨æœº"><a href="#å†™-ofiios-åŠ¨æœº" class="headerlink" title="å†™ ofiios åŠ¨æœº"></a>å†™ ofiios åŠ¨æœº</h3><p>è‡ª<code> Masonry</code> çš„æ¨ªç©ºå‡ºä¸–ï¼Œå…¶é“¾å¼ç¼–ç¨‹çš„å§¿åŠ¿å±¡è¯•ä¸çˆ½ï¼Œç›¸æ¯”äºiOSçš„ä¹¦å†™å§¿åŠ¿æ›´è§å…¶ğŸ‚ï¼Œ <code>Masonry</code> ä¸­èƒ½å®ç°è¿™ç§é“¾å¼ç¼–ç¨‹æ–¹å¼é‚£ä¹ˆiOSæ§ä»¶åˆ›å»ºä¹Ÿä¸€å®šèƒ½å®ç°è¿™ç§æ–¹å¼ï¼Œåœ¨çœ‹å®Œå…¶å†…éƒ¨å®ç°åï¼Œåœ¨é—²ä½™æ—¶é—´å†³å®šè‡ªå·±å°† UIKit é‡å†™ä¸€éè¾¾åˆ°å…¶ä¸€æ ·çš„æ•ˆæœï¼Œå¸Œæœ›åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯¹å¼€å‘æ•ˆç‡å’Œä»£ç çš„å¯è¯»æ€§æœ‰ä¸€å®šçš„å¸®åŠ©ã€‚</p>
<h3 id="ofiios-å¼•å…¥"><a href="#ofiios-å¼•å…¥" class="headerlink" title="ofiios å¼•å…¥"></a>ofiios å¼•å…¥</h3><blockquote>
<h5 id="æ”¯æŒé€šè¿‡-pod-ofiios"><a href="#æ”¯æŒé€šè¿‡-pod-ofiios" class="headerlink" title="æ”¯æŒé€šè¿‡ pod ofiios"></a>æ”¯æŒé€šè¿‡<code> pod ofiios</code></h5></blockquote>
<blockquote>
<h5 id="å¯ç›´æ¥ä¸‹è½½å¼•å…¥"><a href="#å¯ç›´æ¥ä¸‹è½½å¼•å…¥" class="headerlink" title="å¯ç›´æ¥ä¸‹è½½å¼•å…¥"></a>å¯ç›´æ¥ä¸‹è½½å¼•å…¥</h5></blockquote>
<blockquote>
<h6 id="import-lt-ofiios-ofiios-h-gt"><a href="#import-lt-ofiios-ofiios-h-gt" class="headerlink" title="#import &lt;ofiios/ofiios.h&gt;"></a>#import &lt;ofiios/ofiios.h&gt;</h6></blockquote>
<h3 id="ç”¨æ³•ç¤ºä¾‹"><a href="#ç”¨æ³•ç¤ºä¾‹" class="headerlink" title="ç”¨æ³•ç¤ºä¾‹"></a>ç”¨æ³•ç¤ºä¾‹</h3><h6 id="æ§ä»¶åˆ›å»ºğŸŒ°"><a href="#æ§ä»¶åˆ›å»ºğŸŒ°" class="headerlink" title="æ§ä»¶åˆ›å»ºğŸŒ°"></a>æ§ä»¶åˆ›å»ºğŸŒ°</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[UILabel generator:^(Maker * _Nonnull maker) &#123;</span><br><span class="line">        maker.frame(CGRectMake(100, 100, 100, 30)).text(@&quot;ä½ å¥½å•Šï¼ç‹å°äºŒ&quot;).textAlignment(NSTextAlignmentCenter).textColor([UIColor whiteColor]).view(self.view).backGroudColor([UIColor redColor]).radian(CGSizeMake(25, 25)).click(^&#123;</span><br><span class="line">            NSLog(@&quot;click&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure>

<h6 id="ç½‘ç»œæ•°æ®è¯·æ±‚ğŸŒ°"><a href="#ç½‘ç»œæ•°æ®è¯·æ±‚ğŸŒ°" class="headerlink" title="ç½‘ç»œæ•°æ®è¯·æ±‚ğŸŒ°"></a>ç½‘ç»œæ•°æ®è¯·æ±‚ğŸŒ°</h6><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span> patch:^(Patcher * _Nonnull patcher) &#123;</span><br><span class="line">        patcher.role(<span class="built_in">UIPatcherRoleGet</span>).url(<span class="string">@&quot;https://zhqd.shiminjia.com/weather.php&quot;</span>).indicator(<span class="literal">YES</span>);</span><br><span class="line">        [patcher send:^(<span class="keyword">id</span>  _Nonnull respone) &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;respone---%@&quot;</span>,respone);</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure>

<h3 id="ç‰ˆæœ¬è®¾è®¡åŸºçº¿"><a href="#ç‰ˆæœ¬è®¾è®¡åŸºçº¿" class="headerlink" title="ç‰ˆæœ¬è®¾è®¡åŸºçº¿"></a>ç‰ˆæœ¬è®¾è®¡åŸºçº¿</h3><p>ofiiosä¸­å‡ ä¹æ¶µç›–äº†æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ç”¨åˆ°çš„å¯¹è±¡ï¼ŒåæœŸè¿˜ä¼šå¢åŠ ä¸€äº›æ‹“å±•ï¼Œä¹ŸæœŸç›¼æ‚¨æœ‰æ›´å¥½çš„æƒ³æ³•ä¸ºå…¶æ‹“å±•ã€‚</p>
<h3 id="æœŸå¾…æ›´å¥½æƒ³æ³•"><a href="#æœŸå¾…æ›´å¥½æƒ³æ³•" class="headerlink" title="æœŸå¾…æ›´å¥½æƒ³æ³•"></a>æœŸå¾…æ›´å¥½æƒ³æ³•</h3><p>å¦‚æœæ‚¨æœ‰æ›´å¤šå¥½çš„è®¾è®¡å’Œæƒ³æ³•ï¼Œå¯ä»¥åŠ å…¥æˆ‘ä»¬~</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/io/tags/iOS/">iOS</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/io/2021/03/31/OCå¯¹è±¡çš„æœ¬è´¨/"><span>OCå¯¹è±¡çš„æœ¬è´¨</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/io/2021/03/31/OCå¯¹è±¡çš„æœ¬è´¨/" rel="bookmark">
        <time class="entry-date published" datetime="2021-03-31T06:26:53.000Z">
          2021-03-31
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="OC-å¯¹è±¡çš„æœ¬è´¨"><a href="#OC-å¯¹è±¡çš„æœ¬è´¨" class="headerlink" title="OC å¯¹è±¡çš„æœ¬è´¨"></a>OC å¯¹è±¡çš„æœ¬è´¨</h1><p>æœ€è¿‘æ—¶é—´å……è¶³ï¼Œæ‰“ç®—å†æ¬¡å¯¹ Object-C è¿›è¡Œåˆ†æï¼Œè€Œ Object-Cæœ¬èº«ç»å¯¹æ˜¯ä¼˜é›…å’Œç¾ä¸½çš„ï¼Œæ‰€ä»¥ä»è¿™é‡Œå¼€å§‹ï¼Œæˆ‘ä»¬å’ŒObject-Cæ¥ä¸€åœºç¾ä¸½çš„é‚‚é€…!</p>
<h2 id="ä¸€ã€è®¤è¯†Object-Cå¯¹è±¡"><a href="#ä¸€ã€è®¤è¯†Object-Cå¯¹è±¡" class="headerlink" title="ä¸€ã€è®¤è¯†Object-Cå¯¹è±¡"></a>ä¸€ã€è®¤è¯†Object-Cå¯¹è±¡</h2><blockquote>
<h4 id="Object-Cæœ¬è´¨"><a href="#Object-Cæœ¬è´¨" class="headerlink" title="Object-Cæœ¬è´¨"></a>Object-Cæœ¬è´¨</h4><blockquote>
<ul>
<li>æˆ‘ä»¬å¹³å¸¸ç¼–å†™çš„Object-Cä»£ç ï¼Œåº•å±‚å…¶å®éƒ½æ˜¯C/C++ä»£ç ï¼Œç¼–è¯‘å™¨å†ç¼–è¯‘æˆæ±‡ç¼–ï¼Œæœ€ç»ˆå½¢æˆæœºå™¨è¯­è¨€</li>
<li>å¯¹è±¡ã€ç±» ä¸»è¦æ˜¯åŸºäºC/C++ç»“æ„ä½“å®ç°</li>
</ul>
</blockquote>
</blockquote>
<p>é‚£ä¹ˆä¸€ä¸ªObject-Cå¯¹è±¡åœ¨åº•å±‚ä¸­å¦‚ä½•å¸ƒå±€çš„ï¼Ÿé€šè¿‡åˆ†æä¸éš¾å‘ç°å…¶åº•å±‚å®ç°å¦‚ä¸‹å›¾</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NSObject_IMPL</span>&#123;</span></span><br><span class="line"> Class isa</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<h3 id="å†…å­˜åˆçª¥"><a href="#å†…å­˜åˆçª¥" class="headerlink" title="å†…å­˜åˆçª¥"></a>å†…å­˜åˆçª¥</h3><blockquote>
<ul>
<li>ä¸€ä¸ªObject-Cå¯¹è±¡ä¼šè¢«åˆ†é…ä¸å°‘äº 16 bytes çš„ç©ºé—´</li>
<li>å¯¹è±¡çš„æŒ‡é’ˆåœ°å€ä¸ºç¬¬ä¸€ä¸ªæˆå‘˜çš„åœ°å€</li>
<li>éµå®ˆå†…å­˜å¯¹å…¶åŸåˆ™</li>
</ul>
</blockquote>
</blockquote>
<p>å¯èƒ½ä½ å¯¹æœ€å°åˆ†é…16å­—èŠ‚å¤§å°çš„ç»“è®ºæœ‰ç–‘é—®ï¼Œå¯ä»¥ç‚¹å‡»  <a target="_blank" rel="noopener" href="https://opensource.apple.com/tarballs/objc4/">objc4/</a> ä¸‹è½½æºç æŸ¥çœ‹å†…éƒ¨å®ç° ã€‚åœ¨ objc-class-old æ–‡ä»¶çš„ _class_createInstanceFromZone(Class cls, size_t extraBytes, void *zone)  æ–¹æ³•ä¸­å®ç°äº†ä¸‹é¢è§„å®š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">_class_createInstanceFromZone(Class cls, <span class="keyword">size_t</span> extraBytes, <span class="keyword">void</span> *zone)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">void</span> *bytes;</span><br><span class="line">    <span class="keyword">size_t</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Can&#x27;t create something for nothing</span></span><br><span class="line">    <span class="keyword">if</span> (!cls) <span class="keyword">return</span> nil;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allocate and initialize</span></span><br><span class="line">    size = cls-&gt;alignedInstanceSize() + extraBytes;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    æ­¤å¤„ä¸ºå®˜æ–¹ç¡¬æ€§è§„å®š</span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="comment">// CF requires all objects be at least 16 bytes.</span></span><br><span class="line">    <span class="keyword">if</span> (size &lt; <span class="number">16</span>) size = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (zone) &#123;</span><br><span class="line">        bytes = malloc_zone_calloc((<span class="keyword">malloc_zone_t</span> *)zone, <span class="number">1</span>, size);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        bytes = <span class="built_in">calloc</span>(<span class="number">1</span>, size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> objc_constructInstance(cls, bytes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†…å­˜å¯¹é½åˆæ˜¯æ€ä¹ˆä¸€å›äº‹? çœ‹çœ‹å®˜æ–¹è¯´æ˜ä¸€è§£ç–‘æƒ‘</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Class&#x27;s ivar size rounded up to a pointer-size boundary.</span></span><br><span class="line"><span class="comment">// alignedInstanceSize è¿”å›å¯¹é½å¤§å°</span></span><br><span class="line"><span class="comment">// unalignedInstanceSize æœªå¯¹é½ä¹‹å‰å¤§å°</span></span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">alignedInstanceSize</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; </span><br><span class="line">  <span class="keyword">return</span> word_align(unalignedInstanceSize());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€Object-Cå¯¹è±¡åˆ›å»ºåŸç†"><a href="#äºŒã€Object-Cå¯¹è±¡åˆ›å»ºåŸç†" class="headerlink" title="äºŒã€Object-Cå¯¹è±¡åˆ›å»ºåŸç†"></a>äºŒã€Object-Cå¯¹è±¡åˆ›å»ºåŸç†</h2><p>å®˜æ–¹ç»™å‡ºäº†ä¸¤ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œæ–¹å¼ä¸€ï¼šé€šè¿‡ <code> [[object alloc]init]</code> ,æ–¹å¼äºŒï¼šé€šè¿‡ <code> [object new]</code> ä¸‹é¢æˆ‘ä»¬ç”¨ä¸¤ç§æ–¹å¼æ¥æ–°å»ºä¸€ä¸ª <code>Person</code> å¯¹è±¡ä¸€æ¢ç©¶ç«Ÿã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person * person = [[Person alloc] init];</span><br></pre></td></tr></table></figure>

<p>ç®€å•çš„ä¸€æ¬¡è°ƒç”¨ï¼Œå…¶èƒŒååŸç†ä¸ºä½•ï¼Ÿ</p>
<p>æˆ‘å°†è°ƒç”¨ <code> alloc</code> æ•´ä¸ªæºç æµç¨‹è´´å‡ºæ–¹ä¾¿å¤§å®¶æ¯”å¯¹</p>
<h5 id="2-1-æºç å¤„ç†æµç¨‹"><a href="#2-1-æºç å¤„ç†æµç¨‹" class="headerlink" title="2.1 æºç å¤„ç†æµç¨‹"></a>2.1 æºç å¤„ç†æµç¨‹</h5><ol>
<li>å…ˆè°ƒç”¨  objc_alloc ï¼Œæ­¤å¤„ä¼šå»è°ƒç”¨ <code>callAlloc </code>å‡½æ•°ï¼Œæ³¨æ„åä¸¤ä¸ªå‚æ•°</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Calls [cls alloc].</span></span><br><span class="line">id</span><br><span class="line">objc_alloc(Class cls)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> callAlloc(cls, <span class="literal">true</span><span class="comment">/*checkNil*/</span>, <span class="literal">false</span><span class="comment">/*allocWithZone*/</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>é‚£ä¹ˆè·³è½¬åˆ° <code>callAlloc</code> å‡½æ•° ç³»ç»Ÿåˆå¤„ç†äº†ä»€ä¹ˆé€»è¾‘å‘¢ï¼Ÿ</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Call [cls alloc] or [cls allocWithZone:nil], with appropriate </span></span><br><span class="line"><span class="comment">// shortcutting optimizations. // ç®—æ³•ä¼˜åŒ–</span></span><br><span class="line">callAlloc(Class cls, <span class="keyword">bool</span> checkNil, <span class="keyword">bool</span> allocWithZone=<span class="literal">false</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> __OBJC2__  <span class="comment">//åœ¨ objc2ä¸­ ç³»ç»Ÿä¼šå¤„ç†è¿™äº›å‡½æ•°</span></span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  ç¬”è®°</span></span><br><span class="line"><span class="comment">  callAlloc(Class cls, bool checkNil, bool allocWithZone=false)</span></span><br><span class="line"><span class="comment">  ç¬¬ä¸€æ¬¡ checkNil=true </span></span><br><span class="line"><span class="comment">  allocWithZone=falseï¼Œå…¶é»˜è®¤å°±æ˜¯ false</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  #define fastpath(x) (__builtin_expect(bool(x), 1))ï¼š xå€¼è¶Šå¤§è¡¨ç¤ºä¸ºçœŸçš„ç»“æœå¯èƒ½æ€§æ›´å¤§</span></span><br><span class="line"><span class="comment">  #define slowpath(x) (__builtin_expect(bool(x), 0))   xå€¼è¶Šå°è¡¨ç¤ºä¸ºå‡çš„ç»“æœå¯èƒ½æ€§æ›´å¤§</span></span><br><span class="line"><span class="comment">  __builtin_expectï¼šæ˜¯ GCCæä¾›çš„ç»™æˆ‘ä»¬çš„ï¼Œç›®å‰åœ¨äºå…è®¸æˆ‘ä»¬å°†æœ€æœ‰å¯èƒ½æ‰§è¡Œçš„åˆ†æ”¯å‘Šè¯‰ç¼–è¯‘å™¨ã€‚ä»¥è¾¾åˆ°å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå‡å°‘æŒ‡ä»¤è·³è½¬å¸¦æ¥çš„æ€§èƒ½ä¸‹é™ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> (slowpath(checkNil &amp;&amp; !cls)) <span class="keyword">return</span> nil;</span><br><span class="line">    <span class="keyword">if</span> (fastpath(!cls-&gt;ISA()-&gt;hasCustomAWZ())) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæ¡ä»¶æˆç«‹ è°ƒç”¨  _objc_rootAllocWithZone </span></span><br><span class="line">        <span class="keyword">return</span> _objc_rootAllocWithZone(cls, nil);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// No shortcuts available. //å¦‚æ²¡æœ‰æœ€ä¼˜æ·å¾„</span></span><br><span class="line">    <span class="keyword">if</span> (allocWithZone) &#123; <span class="comment">//å¦‚å®ç°äº†allocWithZone æ–¹æ³• å®ç°æ¶ˆæ¯è½¬è¾¾ allocWithZone æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> ((id(*)(id, SEL, struct _NSZone *))objc_msgSend)(cls, @selector(allocWithZone:), nil);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// æœªå®ç°  allocWithZone ï¼Œç›´æ¥è°ƒç”¨ alloc æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">return</span> ((id(*)(id, SEL))objc_msgSend)(cls, @selector(alloc));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>åœ¨ç¬¬äºŒæ­¥ä¸­å­˜åœ¨ä¸¤ç§è°ƒç”¨å…³ç³»ï¼Œä¸€ç§æ˜¯å­˜åœ¨æœ€ä¼˜åŒ–æ·å¾„ åˆ™ç›´æ¥è°ƒç”¨  <code> rootAllocWithZone</code> æ–¹æ³•ï¼›ä¸€ç§åˆ™æ˜¯åœ¨é<code> objc2</code> ä¸‹ å®ç° <code>allocWithZone </code>æˆ–è€… <code>alloc  </code> å‡½æ•°ã€‚</p>
<p>åœ¨æºç ä¸­å®˜æ–¹ç›´æ¥å»è°ƒç”¨ <code> _class_createInstanceFromZone</code> å‡½æ•°ç”³è¯·å­˜å‚¨ç©ºé—´æœ‰å…´è¶£çš„åŒä»å¯ä»¥è·Ÿè¸ªä¸‹æºç çœ‹çœ‹å®˜æ–¹æ€ä¹ˆè¿›è¡Œå­˜å‚¨ç©ºé—´å¼€è¾Ÿçš„ï¼Œè¿™é‡Œä½ ä¼šå¯¹å‰é¢<code>å†…å­˜åˆçª¥</code>ä¸­å†™é“çš„ç»“è®ºæœ‰ä¸ªæ·±åˆ»çš„è®¤è¯†ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">_objc_rootAllocWithZone(Class cls, malloc_zone_t *zone __unused)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// allocWithZone under __OBJC2__ ignores the zone parameter</span></span><br><span class="line">    <span class="keyword">return</span> _class_createInstanceFromZone(cls, <span class="number">0</span>, nil,</span><br><span class="line">                                         OBJECT_CONSTRUCT_CALL_BADALLOC);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äº<code>alloc</code>æ–¹æ³• ç³»ç»Ÿå®ç°èµ·æ¥å°±æ˜¾å¾—ä¸é‚£ä¹ˆå¤æ‚äº†</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ (id)alloc &#123;</span><br><span class="line">    <span class="keyword">return</span> _objc_rootAlloc(self);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
</blockquote>
<h5 id="2-2-init-åŸç†"><a href="#2-2-init-åŸç†" class="headerlink" title="2.2 init åŸç†"></a>2.2 init åŸç†</h5><p>åˆ†æå®Œäº† <code>alloc</code> çš„æµç¨‹ï¼Œæˆ‘ä»¬æ¥ç€åˆ†æ <code>init</code> çš„æµç¨‹ã€‚ç›¸æ¯”äº <code>alloc</code> æ¥è¯´ï¼Œ <code>init</code> å†…éƒ¨å®ç°ååˆ†ç®€å•ï¼Œå…ˆæ¥åˆ°çš„æ˜¯ <code>_objc_rootInit</code> ï¼Œç„¶åå°±ç›´æ¥è¿”å› <code>obj</code> äº†ã€‚å…¶å®è¿™é‡Œæ˜¯ä¸€ç§æŠ½è±¡å·¥å‚è®¾è®¡æ¨¡å¼çš„ä½“ç°ï¼Œå¯¹äº <code>NSObject</code> è‡ªå¸¦çš„ <code>init</code> æ–¹æ³•æ¥è¯´ï¼Œå…¶å®å•¥ä¹Ÿæ²¡å¹²ï¼Œä½†æ˜¯å¦‚æœä½ ç»§æ‰¿äº <code>NSObject</code> çš„è¯ï¼Œç„¶åå°±å¯ä»¥å»é‡å†™ `initWithxyz ä¹‹ç±»çš„åˆå§‹åŒ–æ–¹æ³•æ¥åšä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Replaced by CF (throws an NSException)</span></span><br><span class="line">+ (id)<span class="keyword">init</span> &#123;</span><br><span class="line">  <span class="comment">// å·¥å‚è®¾è®¡æ¨¡å¼</span></span><br><span class="line">    <span class="keyword">return</span> (id)self;</span><br><span class="line">&#125;</span><br><span class="line">- (id)<span class="keyword">init</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> _objc_rootInit(self);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h2><p>å¼€å‘è¿‡ç¨‹ä¸­æ¢ç©¶æºç ä¼šè®©æˆ‘ä»¬å¯¹ä¸€é¡¹äº‹åŠ¡æœ‰ä¸ä¸€æ ·çš„è®¤è¯†ï¼Œå»ºè®®åŒä»å¤šé˜…è¯»æºç ã€‚                                      </p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/io/tags/iOS/">iOS</a>
    </span>
    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2021 coderz
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>
<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>coderz - è®°å½•æ¯ä¸€åˆ» | coderz</title>

  
  <meta name="author" content="coderz">
  

  
  <meta name="description" content="coderz- è®°å½•ä¸ªäººæ—¥å¸¸">
  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="coderz - è®°å½•æ¯ä¸€åˆ»"/>

  
  <meta property="og:image" content="/io/favicon.ico"/>
  

  <link href="/io/favicon.ico" rel="icon">
  <link rel="alternate" href="/io/atom.xml" title="coderz - è®°å½•æ¯ä¸€åˆ»" type="application/atom+xml">
  <link rel="stylesheet" href="/io/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/io/">coderz - è®°å½•æ¯ä¸€åˆ»</a>
    </h1>
    <p class="site-description">coderz</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/io/2021/04/09/UIMaker/"><span>UIMaker</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/io/2021/04/09/UIMaker/" rel="bookmark">
        <time class="entry-date published" datetime="2021-04-09T09:38:59.000Z">
          2021-04-09
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>åå­—æ²¡æƒ³å¥½ï¼Œå°±æš‚ä¸”å«å®ƒ   <a target="_blank" rel="noopener" href="https://github.com/coderx-waper/UIMaker">UIMaker</a></p>
<h3 id="å†™UIMaker-åŠ¨æœº"><a href="#å†™UIMaker-åŠ¨æœº" class="headerlink" title="å†™UIMaker åŠ¨æœº"></a>å†™UIMaker åŠ¨æœº</h3><p>è‡ª<code> Masonry</code> çš„æ¨ªç©ºå‡ºä¸–ï¼Œå…¶é“¾å¼ç¼–ç¨‹çš„å§¿åŠ¿å±¡è¯•ä¸çˆ½ï¼Œç›¸æ¯”äºiOSçš„ä¹¦å†™å§¿åŠ¿æ›´è§å…¶ğŸ‚ï¼Œ <code>Masonry</code> ä¸­èƒ½å®ç°è¿™ç§é“¾å¼ç¼–ç¨‹æ–¹å¼é‚£ä¹ˆiOSæ§ä»¶åˆ›å»ºä¹Ÿä¸€å®šèƒ½å®ç°è¿™ç§æ–¹å¼ï¼Œåœ¨çœ‹å®Œå…¶å†…éƒ¨å®ç°åï¼Œåœ¨é—²ä½™æ—¶é—´å†³å®šè‡ªå·±å°† UIKit é‡å†™ä¸€éè¾¾åˆ°å…¶ä¸€æ ·çš„æ•ˆæœï¼Œå¸Œæœ›åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯¹å¼€å‘æ•ˆç‡å’Œä»£ç çš„å¯è¯»æ€§æœ‰ä¸€å®šçš„å¸®åŠ©ã€‚</p>
<h3 id="UIMaker-å¼•å…¥"><a href="#UIMaker-å¼•å…¥" class="headerlink" title="UIMaker å¼•å…¥"></a>UIMaker å¼•å…¥</h3><blockquote>
<h5 id="æ”¯æŒé€šè¿‡-pod-UIMaker"><a href="#æ”¯æŒé€šè¿‡-pod-UIMaker" class="headerlink" title="æ”¯æŒé€šè¿‡ pod UIMaker"></a>æ”¯æŒé€šè¿‡<code> pod UIMaker</code></h5></blockquote>
<blockquote>
<h5 id="å¯ç›´æ¥ä¸‹è½½å¼•å…¥"><a href="#å¯ç›´æ¥ä¸‹è½½å¼•å…¥" class="headerlink" title="å¯ç›´æ¥ä¸‹è½½å¼•å…¥"></a>å¯ç›´æ¥ä¸‹è½½å¼•å…¥</h5></blockquote>
<h3 id="ç”¨æ³•ç¤ºä¾‹"><a href="#ç”¨æ³•ç¤ºä¾‹" class="headerlink" title="ç”¨æ³•ç¤ºä¾‹"></a>ç”¨æ³•ç¤ºä¾‹</h3><blockquote>
<h5 id="ç›®å‰-æ”¯æŒåˆ›å»º-UILabel-ã€-UIButton-ã€-UIImageView-ã€-UITableView-ã€-UITextField-ã€UITextView-ã€UICollectionView-åç»­è¿˜ä¼šç»§ç»­æ‹“å±•"><a href="#ç›®å‰-æ”¯æŒåˆ›å»º-UILabel-ã€-UIButton-ã€-UIImageView-ã€-UITableView-ã€-UITextField-ã€UITextView-ã€UICollectionView-åç»­è¿˜ä¼šç»§ç»­æ‹“å±•" class="headerlink" title="ç›®å‰ æ”¯æŒåˆ›å»º UILabel ã€ UIButton ã€ UIImageView ã€ UITableView ã€ UITextField  ã€UITextView ã€UICollectionView åç»­è¿˜ä¼šç»§ç»­æ‹“å±•"></a>ç›®å‰ æ”¯æŒåˆ›å»º <code>UILabel</code> ã€<code> UIButton</code> ã€<code> UIImageView</code> ã€<code> UITableView</code> ã€<code> UITextField</code>  ã€<code>UITextView </code>ã€<code>UICollectionView </code>åç»­è¿˜ä¼šç»§ç»­æ‹“å±•</h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Maker(<span class="built_in">UIMakerTypeLabel</span>) mas_make:^(<span class="built_in">UIMaker</span> * _Nonnull make) &#123;</span><br><span class="line">make.text(<span class="string">@&quot;Maker mas_make successed!&quot;</span>)</span><br><span class="line">.frame(<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">80</span>))</span><br><span class="line">.backGroudColor([<span class="built_in">UIColor</span> redColor])</span><br><span class="line">.fontSize(<span class="number">16</span>)</span><br><span class="line">.textColor([<span class="built_in">UIColor</span> whiteColor])</span><br><span class="line">.lineBreakMode(<span class="built_in">NSLineBreakByTruncatingMiddle</span>).radian(<span class="built_in">CGSizeMake</span>(<span class="number">10</span>, <span class="number">10</span>));</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
</blockquote>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/io/2021/03/31/OCå¯¹è±¡çš„æœ¬è´¨/"><span>OCå¯¹è±¡çš„æœ¬è´¨</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/io/2021/03/31/OCå¯¹è±¡çš„æœ¬è´¨/" rel="bookmark">
        <time class="entry-date published" datetime="2021-03-31T06:26:53.000Z">
          2021-03-31
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="OC-å¯¹è±¡çš„æœ¬è´¨"><a href="#OC-å¯¹è±¡çš„æœ¬è´¨" class="headerlink" title="OC å¯¹è±¡çš„æœ¬è´¨"></a>OC å¯¹è±¡çš„æœ¬è´¨</h1><p>æœ€è¿‘æ—¶é—´å……è¶³ï¼Œæ‰“ç®—å†æ¬¡å¯¹ Object-C è¿›è¡Œåˆ†æï¼Œè€Œ Object-Cæœ¬èº«ç»å¯¹æ˜¯ä¼˜é›…å’Œç¾ä¸½çš„ï¼Œæ‰€ä»¥ä»è¿™é‡Œå¼€å§‹ï¼Œæˆ‘ä»¬å’ŒObject-Cæ¥ä¸€åœºç¾ä¸½çš„é‚‚é€…!</p>
<h2 id="ä¸€ã€è®¤è¯†Object-Cå¯¹è±¡"><a href="#ä¸€ã€è®¤è¯†Object-Cå¯¹è±¡" class="headerlink" title="ä¸€ã€è®¤è¯†Object-Cå¯¹è±¡"></a>ä¸€ã€è®¤è¯†Object-Cå¯¹è±¡</h2><blockquote>
<h4 id="Object-Cæœ¬è´¨"><a href="#Object-Cæœ¬è´¨" class="headerlink" title="Object-Cæœ¬è´¨"></a>Object-Cæœ¬è´¨</h4><blockquote>
<ul>
<li>æˆ‘ä»¬å¹³å¸¸ç¼–å†™çš„Object-Cä»£ç ï¼Œåº•å±‚å…¶å®éƒ½æ˜¯C/C++ä»£ç ï¼Œç¼–è¯‘å™¨å†ç¼–è¯‘æˆæ±‡ç¼–ï¼Œæœ€ç»ˆå½¢æˆæœºå™¨è¯­è¨€</li>
<li>å¯¹è±¡ã€ç±» ä¸»è¦æ˜¯åŸºäºC/C++ç»“æ„ä½“å®ç°</li>
</ul>
</blockquote>
</blockquote>
<p>é‚£ä¹ˆä¸€ä¸ªObject-Cå¯¹è±¡åœ¨åº•å±‚ä¸­å¦‚ä½•å¸ƒå±€çš„ï¼Ÿé€šè¿‡åˆ†æä¸éš¾å‘ç°å…¶åº•å±‚å®ç°å¦‚ä¸‹å›¾</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NSObject_IMPL</span>&#123;</span></span><br><span class="line"> Class isa</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<h3 id="å†…å­˜åˆçª¥"><a href="#å†…å­˜åˆçª¥" class="headerlink" title="å†…å­˜åˆçª¥"></a>å†…å­˜åˆçª¥</h3><blockquote>
<ul>
<li>ä¸€ä¸ªObject-Cå¯¹è±¡ä¼šè¢«åˆ†é…ä¸å°‘äº 16 bytes çš„ç©ºé—´</li>
<li>å¯¹è±¡çš„æŒ‡é’ˆåœ°å€ä¸ºç¬¬ä¸€ä¸ªæˆå‘˜çš„åœ°å€</li>
<li>éµå®ˆå†…å­˜å¯¹å…¶åŸåˆ™</li>
</ul>
</blockquote>
</blockquote>
<p>å¯èƒ½ä½ å¯¹æœ€å°åˆ†é…16å­—èŠ‚å¤§å°çš„ç»“è®ºæœ‰ç–‘é—®ï¼Œå¯ä»¥ç‚¹å‡»  <a target="_blank" rel="noopener" href="https://opensource.apple.com/tarballs/objc4/">objc4/</a> ä¸‹è½½æºç æŸ¥çœ‹å†…éƒ¨å®ç° ã€‚åœ¨ objc-class-old æ–‡ä»¶çš„ _class_createInstanceFromZone(Class cls, size_t extraBytes, void *zone)  æ–¹æ³•ä¸­å®ç°äº†ä¸‹é¢è§„å®š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">_class_createInstanceFromZone(Class cls, <span class="keyword">size_t</span> extraBytes, <span class="keyword">void</span> *zone)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">void</span> *bytes;</span><br><span class="line">    <span class="keyword">size_t</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Can&#x27;t create something for nothing</span></span><br><span class="line">    <span class="keyword">if</span> (!cls) <span class="keyword">return</span> nil;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allocate and initialize</span></span><br><span class="line">    size = cls-&gt;alignedInstanceSize() + extraBytes;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    æ­¤å¤„ä¸ºå®˜æ–¹ç¡¬æ€§è§„å®š</span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="comment">// CF requires all objects be at least 16 bytes.</span></span><br><span class="line">    <span class="keyword">if</span> (size &lt; <span class="number">16</span>) size = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (zone) &#123;</span><br><span class="line">        bytes = malloc_zone_calloc((<span class="keyword">malloc_zone_t</span> *)zone, <span class="number">1</span>, size);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        bytes = <span class="built_in">calloc</span>(<span class="number">1</span>, size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> objc_constructInstance(cls, bytes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†…å­˜å¯¹é½åˆæ˜¯æ€ä¹ˆä¸€å›äº‹? çœ‹çœ‹å®˜æ–¹è¯´æ˜ä¸€è§£ç–‘æƒ‘</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Class&#x27;s ivar size rounded up to a pointer-size boundary.</span></span><br><span class="line"><span class="comment">// alignedInstanceSize è¿”å›å¯¹é½å¤§å°</span></span><br><span class="line"><span class="comment">// unalignedInstanceSize æœªå¯¹é½ä¹‹å‰å¤§å°</span></span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">alignedInstanceSize</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; </span><br><span class="line">  <span class="keyword">return</span> word_align(unalignedInstanceSize());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€Object-Cå¯¹è±¡åˆ›å»ºåŸç†"><a href="#äºŒã€Object-Cå¯¹è±¡åˆ›å»ºåŸç†" class="headerlink" title="äºŒã€Object-Cå¯¹è±¡åˆ›å»ºåŸç†"></a>äºŒã€Object-Cå¯¹è±¡åˆ›å»ºåŸç†</h2><p>å®˜æ–¹ç»™å‡ºäº†ä¸¤ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œæ–¹å¼ä¸€ï¼šé€šè¿‡ <code> [[object alloc]init]</code> ,æ–¹å¼äºŒï¼šé€šè¿‡ <code> [object new]</code> ä¸‹é¢æˆ‘ä»¬ç”¨ä¸¤ç§æ–¹å¼æ¥æ–°å»ºä¸€ä¸ª <code>Person</code> å¯¹è±¡ä¸€æ¢ç©¶ç«Ÿã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person * person = [[Person alloc] init];</span><br></pre></td></tr></table></figure>

<p>ç®€å•çš„ä¸€æ¬¡è°ƒç”¨ï¼Œå…¶èƒŒååŸç†ä¸ºä½•ï¼Ÿ</p>
<p>æˆ‘å°†è°ƒç”¨ <code> alloc</code> æ•´ä¸ªæºç æµç¨‹è´´å‡ºæ–¹ä¾¿å¤§å®¶æ¯”å¯¹</p>
<h5 id="2-1-æºç å¤„ç†æµç¨‹"><a href="#2-1-æºç å¤„ç†æµç¨‹" class="headerlink" title="2.1 æºç å¤„ç†æµç¨‹"></a>2.1 æºç å¤„ç†æµç¨‹</h5><ol>
<li>å…ˆè°ƒç”¨  objc_alloc ï¼Œæ­¤å¤„ä¼šå»è°ƒç”¨ <code>callAlloc </code>å‡½æ•°ï¼Œæ³¨æ„åä¸¤ä¸ªå‚æ•°</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Calls [cls alloc].</span></span><br><span class="line">id</span><br><span class="line">objc_alloc(Class cls)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> callAlloc(cls, <span class="literal">true</span><span class="comment">/*checkNil*/</span>, <span class="literal">false</span><span class="comment">/*allocWithZone*/</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>é‚£ä¹ˆè·³è½¬åˆ° <code>callAlloc</code> å‡½æ•° ç³»ç»Ÿåˆå¤„ç†äº†ä»€ä¹ˆé€»è¾‘å‘¢ï¼Ÿ</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Call [cls alloc] or [cls allocWithZone:nil], with appropriate </span></span><br><span class="line"><span class="comment">// shortcutting optimizations. // ç®—æ³•ä¼˜åŒ–</span></span><br><span class="line">callAlloc(Class cls, <span class="keyword">bool</span> checkNil, <span class="keyword">bool</span> allocWithZone=<span class="literal">false</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> __OBJC2__  <span class="comment">//åœ¨ objc2ä¸­ ç³»ç»Ÿä¼šå¤„ç†è¿™äº›å‡½æ•°</span></span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  ç¬”è®°</span></span><br><span class="line"><span class="comment">  callAlloc(Class cls, bool checkNil, bool allocWithZone=false)</span></span><br><span class="line"><span class="comment">  ç¬¬ä¸€æ¬¡ checkNil=true </span></span><br><span class="line"><span class="comment">  allocWithZone=falseï¼Œå…¶é»˜è®¤å°±æ˜¯ false</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  #define fastpath(x) (__builtin_expect(bool(x), 1))ï¼š xå€¼è¶Šå¤§è¡¨ç¤ºä¸ºçœŸçš„ç»“æœå¯èƒ½æ€§æ›´å¤§</span></span><br><span class="line"><span class="comment">  #define slowpath(x) (__builtin_expect(bool(x), 0))   xå€¼è¶Šå°è¡¨ç¤ºä¸ºå‡çš„ç»“æœå¯èƒ½æ€§æ›´å¤§</span></span><br><span class="line"><span class="comment">  __builtin_expectï¼šæ˜¯ GCCæä¾›çš„ç»™æˆ‘ä»¬çš„ï¼Œç›®å‰åœ¨äºå…è®¸æˆ‘ä»¬å°†æœ€æœ‰å¯èƒ½æ‰§è¡Œçš„åˆ†æ”¯å‘Šè¯‰ç¼–è¯‘å™¨ã€‚ä»¥è¾¾åˆ°å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå‡å°‘æŒ‡ä»¤è·³è½¬å¸¦æ¥çš„æ€§èƒ½ä¸‹é™ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> (slowpath(checkNil &amp;&amp; !cls)) <span class="keyword">return</span> nil;</span><br><span class="line">    <span class="keyword">if</span> (fastpath(!cls-&gt;ISA()-&gt;hasCustomAWZ())) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæ¡ä»¶æˆç«‹ è°ƒç”¨  _objc_rootAllocWithZone </span></span><br><span class="line">        <span class="keyword">return</span> _objc_rootAllocWithZone(cls, nil);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// No shortcuts available. //å¦‚æ²¡æœ‰æœ€ä¼˜æ·å¾„</span></span><br><span class="line">    <span class="keyword">if</span> (allocWithZone) &#123; <span class="comment">//å¦‚å®ç°äº†allocWithZone æ–¹æ³• å®ç°æ¶ˆæ¯è½¬è¾¾ allocWithZone æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> ((id(*)(id, SEL, struct _NSZone *))objc_msgSend)(cls, @selector(allocWithZone:), nil);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// æœªå®ç°  allocWithZone ï¼Œç›´æ¥è°ƒç”¨ alloc æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">return</span> ((id(*)(id, SEL))objc_msgSend)(cls, @selector(alloc));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>åœ¨ç¬¬äºŒæ­¥ä¸­å­˜åœ¨ä¸¤ç§è°ƒç”¨å…³ç³»ï¼Œä¸€ç§æ˜¯å­˜åœ¨æœ€ä¼˜åŒ–æ·å¾„ åˆ™ç›´æ¥è°ƒç”¨  <code> rootAllocWithZone</code> æ–¹æ³•ï¼›ä¸€ç§åˆ™æ˜¯åœ¨é<code> objc2</code> ä¸‹ å®ç° <code>allocWithZone </code>æˆ–è€… <code>alloc  </code> å‡½æ•°ã€‚</p>
<p>åœ¨æºç ä¸­å®˜æ–¹ç›´æ¥å»è°ƒç”¨ <code> _class_createInstanceFromZone</code> å‡½æ•°ç”³è¯·å­˜å‚¨ç©ºé—´æœ‰å…´è¶£çš„åŒä»å¯ä»¥è·Ÿè¸ªä¸‹æºç çœ‹çœ‹å®˜æ–¹æ€ä¹ˆè¿›è¡Œå­˜å‚¨ç©ºé—´å¼€è¾Ÿçš„ï¼Œè¿™é‡Œä½ ä¼šå¯¹å‰é¢<code>å†…å­˜åˆçª¥</code>ä¸­å†™é“çš„ç»“è®ºæœ‰ä¸ªæ·±åˆ»çš„è®¤è¯†ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">_objc_rootAllocWithZone(Class cls, malloc_zone_t *zone __unused)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// allocWithZone under __OBJC2__ ignores the zone parameter</span></span><br><span class="line">    <span class="keyword">return</span> _class_createInstanceFromZone(cls, <span class="number">0</span>, nil,</span><br><span class="line">                                         OBJECT_CONSTRUCT_CALL_BADALLOC);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äº<code>alloc</code>æ–¹æ³• ç³»ç»Ÿå®ç°èµ·æ¥å°±æ˜¾å¾—ä¸é‚£ä¹ˆå¤æ‚äº†</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ (id)alloc &#123;</span><br><span class="line">    <span class="keyword">return</span> _objc_rootAlloc(self);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
</blockquote>
<h5 id="2-2-init-åŸç†"><a href="#2-2-init-åŸç†" class="headerlink" title="2.2 init åŸç†"></a>2.2 init åŸç†</h5><p>åˆ†æå®Œäº† <code>alloc</code> çš„æµç¨‹ï¼Œæˆ‘ä»¬æ¥ç€åˆ†æ <code>init</code> çš„æµç¨‹ã€‚ç›¸æ¯”äº <code>alloc</code> æ¥è¯´ï¼Œ <code>init</code> å†…éƒ¨å®ç°ååˆ†ç®€å•ï¼Œå…ˆæ¥åˆ°çš„æ˜¯ <code>_objc_rootInit</code> ï¼Œç„¶åå°±ç›´æ¥è¿”å› <code>obj</code> äº†ã€‚å…¶å®è¿™é‡Œæ˜¯ä¸€ç§æŠ½è±¡å·¥å‚è®¾è®¡æ¨¡å¼çš„ä½“ç°ï¼Œå¯¹äº <code>NSObject</code> è‡ªå¸¦çš„ <code>init</code> æ–¹æ³•æ¥è¯´ï¼Œå…¶å®å•¥ä¹Ÿæ²¡å¹²ï¼Œä½†æ˜¯å¦‚æœä½ ç»§æ‰¿äº <code>NSObject</code> çš„è¯ï¼Œç„¶åå°±å¯ä»¥å»é‡å†™ `initWithxyz ä¹‹ç±»çš„åˆå§‹åŒ–æ–¹æ³•æ¥åšä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Replaced by CF (throws an NSException)</span></span><br><span class="line">+ (id)<span class="keyword">init</span> &#123;</span><br><span class="line">  <span class="comment">// å·¥å‚è®¾è®¡æ¨¡å¼</span></span><br><span class="line">    <span class="keyword">return</span> (id)self;</span><br><span class="line">&#125;</span><br><span class="line">- (id)<span class="keyword">init</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> _objc_rootInit(self);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h2><p>å¼€å‘è¿‡ç¨‹ä¸­æ¢ç©¶æºç ä¼šè®©æˆ‘ä»¬å¯¹ä¸€é¡¹äº‹åŠ¡æœ‰ä¸ä¸€æ ·çš„è®¤è¯†ï¼Œå»ºè®®åŒä»å¤šé˜…è¯»æºç ã€‚                                      </p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/io/tags/iOS/">iOS</a>
    </span>
    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2021 coderz
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>